from .AwsBase import AwsBase
from botocore.errorfactory import ClientError
import logging
from pprint import pprint


logger = logging.getLogger("OEDI")
print(__name__)

class AwsGlue(AwsBase):

    def __init__(self, boto3_session, database_name):
        super().__init__(boto3_session)
        self.glue = self.boto3_session.client('glue')
        self.database_name = database_name

    def create_database(self):
        try:
            response = self.glue.create_database(
                DatabaseInput={
                    'Name': self.database_name,
                    'Description': 'Open Energy Data Initiative Glue catalog database'
                }
            )
            #print(response)

        except ClientError as e:
            if e.response['Error']['Code'] == 'AlreadyExistsException':
                logger.info("Database already exists and will be modified")

    def create_crawler_role(self):
        # the crawlers should only operate on the new database - they need to create and update tables
        """
        Creates the IAM roles required for Glue.
        """
        role_name = f'OEDI_{self.database_name}_crawler_role'

        managed_policies = []
        managed_policies.append('arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole')
        managed_policies.append('arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess')

        logger.info(f"Creating role: {role_name}")
        self.crawler_role_arn = self.iam_helper.role_stitcher(
            role_name,
            'glue',
            f'IAM role for OEDI_{self.database_name}_crawler',
            managed_policie_arns=managed_policies
        )
        print(self.crawler_role_arn)

    ## Crawler based tables
    def create_nrel_garage_array_crawler(self):

        crawler_name = f'{self.database_name}_nrel_garage_pv_array_timeseries_crawler'

        try:
            logger.info(f"Creating crawler {crawler_name}")
            response = self.glue.create_crawler(
                Name=crawler_name,
                Role=self.crawler_role_arn,
                DatabaseName=self.database_name,
                Description='NREL parking garage pv array timeseries data, Golden CO',
                Targets={
                  'S3Targets': [
                      {
                          'Path': self.garage_array_bucket
                      },
                  ],

                },
                #Schedule='string',

                #TablePrefix='string',
                SchemaChangePolicy={
                      'UpdateBehavior': 'UPDATE_IN_DATABASE',
                      'DeleteBehavior': 'DELETE_FROM_DATABASE'
                }

            )

        except ClientError as e:
            if e.response['Error']['Code'] == 'AlreadyExistsException':
                logger.info(f'Crawler {crawler_name} already exists, skipping.')


        logger.info(f"Starting crawler {crawler_name}")

        response2 = self.glue.start_crawler(
          Name=crawler_name
        )


    def create_nrel_stf_array_crawler(self):
        crawler_name = f'{self.database_name}_nrel_stf_pv_array_timeseries_crawler'

        logger.info(f"Creating crawler {crawler_name}")
        try:
            response = self.glue.create_crawler(
                Name=crawler_name,
                Role=self.crawler_role_arn,
                DatabaseName=self.database_name,
                Description='NREL Science and Technology Facility pv array timeseries data, Golden CO',
                Targets={
                  'S3Targets': [
                      {
                          'Path': self.stf_array_bucket
                      },
                  ],

                },
                #Schedule='string',

                #TablePrefix='string',
                SchemaChangePolicy={
                      'UpdateBehavior': 'UPDATE_IN_DATABASE',
                      'DeleteBehavior': 'DELETE_FROM_DATABASE'
                }

            )

        except ClientError as e:
            if e.response['Error']['Code'] == 'AlreadyExistsException':
                logger.info(f'Crawler {crawler_name} already exists, skipping.')

        logger.info(f"Starting crawler {crawler_name}")

        response2 = self.glue.start_crawler(
          Name=crawler_name
        )

    def create_nrel_rsf_array_crawler(self):

        crawler_name = f'{self.database_name}_nrel_rsf_pv_array_timeseries_crawler'

        logger.info(f"Creating crawler {crawler_name}")

        try:
            response = self.glue.create_crawler(
                Name=crawler_name,
                Role=self.crawler_role_arn,
                DatabaseName=self.database_name,
                Description='NREL Research Support Facility pv array timeseries data, Golden CO',
                Targets={
                  'S3Targets': [
                      {
                          'Path': self.rsf_array_bucket
                      },
                  ],

                },
                #Schedule='string',

                #TablePrefix='string',
                SchemaChangePolicy={
                      'UpdateBehavior': 'UPDATE_IN_DATABASE',
                      'DeleteBehavior': 'DELETE_FROM_DATABASE'
                }

            )

        except ClientError as e:
            if e.response['Error']['Code'] == 'AlreadyExistsException':
                logger.info(f'Crawler {crawler_name} already exists, skipping.')

        logger.info(f"Starting crawler {crawler_name}")

        response2 = self.glue.start_crawler(
          Name=crawler_name
        )


    def create_nrel_nwtc_array_crawler(self):

        crawler_name = f'{self.database_name}_nrel_nwtc_pv_array_timeseries_crawler'

        logger.info(f"Creating crawler {crawler_name}")

        try:

            response = self.glue.create_crawler(
                Name=crawler_name,
                Role=self.crawler_role_arn,
                DatabaseName=self.database_name,
                Description='NREL National Wind Technology Center pv array timeseries data, Golden CO',
                Targets={
                  'S3Targets': [
                      {
                          'Path': self.windsite_array_bucket
                      },
                  ],

                },
                #Schedule='string',

                #TablePrefix='string',
                SchemaChangePolicy={
                      'UpdateBehavior': 'UPDATE_IN_DATABASE',
                      'DeleteBehavior': 'DELETE_FROM_DATABASE'
                }

            )

        except ClientError as e:
            if e.response['Error']['Code'] == 'AlreadyExistsException':
                logger.info(f'Crawler {crawler_name} already exists, skipping.')

        logger.info(f"Starting crawler {crawler_name}")

        response2 = self.glue.start_crawler(
          Name=crawler_name
        )


    def create_tracking_the_sun_table(self):

      try:
          logger.info(f"Recreating table: {self.tracking_the_sun_table_name}")
          response = self.glue.delete_table(
              DatabaseName=self.database_name,
              Name=self.tracking_the_sun_table_name
          )
      except ClientError as e:
          if e.response['Error']['Code'] == 'EntityNotFoundException':
              logger.debug(r"Skipping table deletion as it does not exist: {self.tracking_the_sun_table_name}")

      response = self.glue.create_table(
          DatabaseName=self.database_name,
          TableInput={
              "Name": self.tracking_the_sun_table_name,
              "TableType": "EXTERNAL_TABLE",
              "StorageDescriptor": {
                  "Columns": [
                      {
                          "Name": "data provider",
                          "Type": "string"
                      },
                      {
                          "Name": "system id (from data provider)",
                          "Type": "string"
                      },
                      {
                          "Name": "system id (tracking the sun)",
                          "Type": "string"
                      },
                      {
                          "Name": "installation date",
                          "Type": "string"
                      },
                      {
                          "Name": "system size",
                          "Type": "double"
                      },
                      {
                          "Name": "total installed price",
                          "Type": "double"
                      },
                      {
                          "Name": "appraised value flag",
                          "Type": "boolean"
                      },
                      {
                          "Name": "sales tax cost",
                          "Type": "double"
                      },
                      {
                          "Name": "rebate or grant",
                          "Type": "double"
                      },
                      {
                          "Name": "performance-based incentive (annual payment)",
                          "Type": "double"
                      },
                      {
                          "Name": "performance-based incentives (duration)",
                          "Type": "bigint"
                      },
                      {
                          "Name": "feed-in tariff (annual payment)",
                          "Type": "bigint"
                      },
                      {
                          "Name": "feed-in tariff (duration)",
                          "Type": "bigint"
                      },
                      {
                          "Name": "customer segment",
                          "Type": "string"
                      },
                      {
                          "Name": "new construction",
                          "Type": "bigint"
                      },
                      {
                          "Name": "tracking",
                          "Type": "bigint"
                      },
                      {
                          "Name": "tracking type",
                          "Type": "string"
                      },
                      {
                          "Name": "ground mounted",
                          "Type": "bigint"
                      },
                      {
                          "Name": "battery system",
                          "Type": "bigint"
                      },
                      {
                          "Name": "zip code",
                          "Type": "bigint"
                      },
                      {
                          "Name": "city",
                          "Type": "string"
                      },
                      {
                          "Name": "county",
                          "Type": "string"
                      },
                      {
                          "Name": "state",
                          "Type": "string"
                      },
                      {
                          "Name": "utility service territory",
                          "Type": "string"
                      },
                      {
                          "Name": "third-party owned",
                          "Type": "bigint"
                      },
                      {
                          "Name": "installer name",
                          "Type": "string"
                      },
                      {
                          "Name": "self-installed",
                          "Type": "bigint"
                      },
                      {
                          "Name": "azimuth #1",
                          "Type": "double"
                      },
                      {
                          "Name": "azimuth #2",
                          "Type": "bigint"
                      },
                      {
                          "Name": "azimuth #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "tilt #1",
                          "Type": "double"
                      },
                      {
                          "Name": "tilt #2",
                          "Type": "bigint"
                      },
                      {
                          "Name": "tilt #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "module manufacturer #1",
                          "Type": "string"
                      },
                      {
                          "Name": "module model #1",
                          "Type": "string"
                      },
                      {
                          "Name": "module manufacturer #2",
                          "Type": "string"
                      },
                      {
                          "Name": "module model #2",
                          "Type": "string"
                      },
                      {
                          "Name": "module manufacturer #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "module model #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "additional module model",
                          "Type": "bigint"
                      },
                      {
                          "Name": "module technology #1",
                          "Type": "string"
                      },
                      {
                          "Name": "module technology #2",
                          "Type": "string"
                      },
                      {
                          "Name": "module technology #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "bipv module #1",
                          "Type": "bigint"
                      },
                      {
                          "Name": "bipv module #2",
                          "Type": "bigint"
                      },
                      {
                          "Name": "bipv module #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "module efficiency #1",
                          "Type": "double"
                      },
                      {
                          "Name": "module efficiency #2",
                          "Type": "double"
                      },
                      {
                          "Name": "module efficiency #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "inverter manufacturer #1",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter model #1",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter quantity #1",
                          "Type": "bigint"
                      },
                      {
                          "Name": "inverter manufacturer #2",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter model #2",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter quantity #2",
                          "Type": "bigint"
                      },
                      {
                          "Name": "inverter manufacturer #3",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter model #3",
                          "Type": "string"
                      },
                      {
                          "Name": "inverter quantity #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "additional inverter model",
                          "Type": "bigint"
                      },
                      {
                          "Name": "microinverter #1",
                          "Type": "bigint"
                      },
                      {
                          "Name": "microinverter #2",
                          "Type": "bigint"
                      },
                      {
                          "Name": "microinverter #3",
                          "Type": "bigint"
                      },
                      {
                          "Name": "dc optimizer",
                          "Type": "bigint"
                      }
                  ],
                  "Location": self.tracking_the_sun_bucket,
                  "InputFormat": "org.apache.hadoop.mapred.TextInputFormat",
                  "OutputFormat": "org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat",
                  "NumberOfBuckets": -1,
                  "SerdeInfo": {
                      "SerializationLibrary": "org.apache.hadoop.hive.serde2.OpenCSVSerde",
                      "Parameters": {
                          "field.delim": ","
                      }
                  },


              },
              "Parameters": {
                  "areColumnsQuoted": "false",
                  "averageRecordSize": "677",
                  "classification": "csv",
                  "columnsOrdered": "true",
                  "compressionType": "zip",
                  "delimiter": ",",
                  "exclusions": "[\"s3://*/*.pdf\"]",
                  "objectCount": "2",
                  "recordCount": "53300",
                  "sizeKey": "51232868",
                  "skip.header.line.count": "1",
                  "typeOfData": "file"
              }

          }
      )

    def get_pv_rooftop_bldg_partition_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'gid',
                                             'Type': 'bigint'},
                                            {'Name': 'bldg_fid',
                                             'Type': 'bigint'},
                                            {'Name': 'the_geom_96703',
                                             'Type': 'string'},
                                            {'Name': 'the_geom_4326',
                                             'Type': 'string'},
                                            {'Name': 'city',
                                             'Type': 'string'},
                                            {'Name': 'state',
                                             'Type': 'string'},
                                            {'Name': 'year',
                                             'Type': 'bigint'},
                                            {'Name': 'region_id',
                                             'Type': 'bigint'},
                                            {'Name': '__index_level_0__',
                                             'Type': 'bigint'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '',
                                               'classification': 'parquet',
                                               'compressionType': 'none',
                                               'objectCount': '1',
                                               'recordCount': '',
                                               'sizeKey': '',
                                               'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_pv_rooftop_rasd_partition_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                 'Columns': [{'Name': 'gid',
                                                  'Type': 'bigint'},
                                                 {'Name': 'the_geom_96703',
                                                  'Type': 'string'},
                                                 {'Name': 'the_geom_4326',
                                                  'Type': 'string'},
                                                 {'Name': 'city',
                                                  'Type': 'string'},
                                                 {'Name': 'state',
                                                  'Type': 'string'},
                                                 {'Name': 'year',
                                                  'Type': 'bigint'},
                                                 {'Name': 'region_id',
                                                  'Type': 'bigint'},
                                                 {'Name': 'serial_id',
                                                  'Type': 'bigint'},
                                                 {'Name': '__index_level_0__',
                                                  'Type': 'bigint'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '',
                                               'classification': 'parquet',
                                               'compressionType': 'none',
                                               'objectCount': '1',
                                               'recordCount': '',
                                               'sizeKey': '',
                                               'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_pv_rooftop_aspects_partition_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'gid',
                                                  'Type': 'bigint'},
                                                 {'Name': 'city',
                                                  'Type': 'string'},
                                                 {'Name': 'state',
                                                  'Type': 'string'},
                                                 {'Name': 'year',
                                                  'Type': 'bigint'},
                                                 {'Name': 'bldg_fid',
                                                  'Type': 'bigint'},
                                                 {'Name': 'aspect',
                                                  'Type': 'bigint'},
                                                 {'Name': 'the_geom_96703',
                                                  'Type': 'string'},
                                                 {'Name': 'the_geom_4326',
                                                  'Type': 'string'},
                                                 {'Name': 'region_id',
                                                  'Type': 'bigint'},
                                                 {'Name': '__index_level_0__',
                                                  'Type': 'bigint'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '',
                                               'classification': 'parquet',
                                               'compressionType': 'none',
                                               'objectCount': '1',
                                               'recordCount': '',
                                               'sizeKey': '',
                                               'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_pv_rooftop_dev_planes_partition_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'bldg_fid',
                                             'Type': 'bigint'},
                                            {'Name': 'footprint_m2',
                                             'Type': 'double'},
                                            {'Name': 'slope',
                                             'Type': 'bigint'},
                                            {'Name': 'flatarea_m2',
                                             'Type': 'double'},
                                            {'Name': 'slopeconversion',
                                             'Type': 'double'},
                                            {'Name': 'slopearea_m2',
                                             'Type': 'double'},
                                            {'Name': 'zip',
                                             'Type': 'string'},
                                            {'Name': 'zip_perc',
                                             'Type': 'double'},
                                            {'Name': 'aspect',
                                             'Type': 'bigint'},
                                            {'Name': 'gid',
                                             'Type': 'bigint'},
                                            {'Name': 'city',
                                             'Type': 'string'},
                                            {'Name': 'state',
                                             'Type': 'string'},
                                            {'Name': 'year',
                                             'Type': 'bigint'},
                                            {'Name': 'region_id',
                                             'Type': 'bigint'},
                                            {'Name': 'the_geom_96703',
                                             'Type': 'string'},
                                            {'Name': 'the_geom_4326',
                                             'Type': 'string'},
                                            {'Name': '__index_level_0__',
                                             'Type': 'bigint'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '445',
                                                    'classification': 'parquet',
                                                    'compressionType': 'none',
                                                    'objectCount': '1',
                                                    'recordCount': '2346013',
                                                    'sizeKey': '1044690204',
                                                    'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_nrel_parking_garage_partition_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'gid',
                                                  'Type': 'bigint'},
                                                 {'Name': 'city',
                                                  'Type': 'string'},
                                                 {'Name': 'state',
                                                  'Type': 'string'},
                                                 {'Name': 'year',
                                                  'Type': 'bigint'},
                                                 {'Name': 'bldg_fid',
                                                  'Type': 'bigint'},
                                                 {'Name': 'aspect',
                                                  'Type': 'bigint'},
                                                 {'Name': 'the_geom_96703',
                                                  'Type': 'string'},
                                                 {'Name': 'the_geom_4326',
                                                  'Type': 'string'},
                                                 {'Name': 'region_id',
                                                  'Type': 'bigint'},
                                                 {'Name': '__index_level_0__',
                                                  'Type': 'bigint'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '',
                                               'classification': 'parquet',
                                               'compressionType': 'none',
                                               'objectCount': '1',
                                               'recordCount': '',
                                               'sizeKey': '',
                                               'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_rsf_array_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'measured_on',
                                                  'Type': 'string'},
                                                 {'Name': 'sensor_name',
                                                  'Type': 'string'},
                                                 {'Name': 'value',
                                                  'Type': 'double'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '',
                                                    'classification': 'parquet',
                                                    'compressionType': 'none',
                                                    'objectCount': '',
                                                    'recordCount': '',
                                                    'sizeKey': '',
                                                    'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}

    def get_garage_array_template(self):
      return {
              'StorageDescriptor': {'BucketColumns': [],
                                    'Columns': [{'Name': 'measured_on',
                                                 'Type': 'string'},
                                                {'Name': 'sensor_name',
                                                 'Type': 'string'},
                                                {'Name': 'value',
                                                 'Type': 'double'}],
                                    'Compressed': False,
                                    'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                    'Location': '',
                                    'NumberOfBuckets': -1,
                                    'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                    'Parameters': {'averageRecordSize': '14',
                                                   'classification': 'parquet',
                                                   'compressionType': 'none',
                                                   'objectCount': '10',
                                                   'recordCount': '3927746',
                                                   'sizeKey': '24146683',
                                                   'typeOfData': 'file'},
                                    'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                                  'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                    'SortColumns': [],
                                    'StoredAsSubDirectories': False},
              'Values': ['']

      }

    def get_stf_array_template(self):
      return {
          'StorageDescriptor': {'BucketColumns': [],
                                'Columns': [{'Name': 'measured_on',
                                                  'Type': 'string'},
                                                 {'Name': 'sensor_name',
                                                  'Type': 'string'},
                                                 {'Name': 'value',
                                                  'Type': 'double'}],
                                'Compressed': False,
                                'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                                'Location': '',
                                'NumberOfBuckets': -1,
                                'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                                'Parameters': {'averageRecordSize': '14',
                                                    'classification': 'parquet',
                                                    'compressionType': 'none',
                                                    'objectCount': '10',
                                                    'recordCount': '3927746',
                                                    'sizeKey': '24146683',
                                                    'typeOfData': 'file'},
                                'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                              'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                                'SortColumns': [],
                                'StoredAsSubDirectories': False},
          'Values': ['']}



    def create_pv_rooftop_buildings_table(self):

      partitionsArray = [{'averageRecordSize': '253',
                            'name': 'chicago_il_08',
                            'recordCount': '903404',
                            'sizeKey': '229002201'},
                           {'averageRecordSize': '304',
                            'name': 'springfield_ma_13',
                            'recordCount': '114405',
                            'sizeKey': '34879403'},
                           {'averageRecordSize': '325',
                            'name': 'elpaso_tx_07',
                            'recordCount': '111316',
                            'sizeKey': '36252660'},
                           {'averageRecordSize': '286',
                            'name': 'lubbock_tx_08',
                            'recordCount': '66388',
                            'sizeKey': '19045494'},
                           {'averageRecordSize': '262',
                            'name': 'fortwayne_in_08',
                            'recordCount': '71043',
                            'sizeKey': '18681955'},
                           {'averageRecordSize': '279',
                            'name': 'providence_ri_12',
                            'recordCount': '213344',
                            'sizeKey': '59662679'},
                           {'averageRecordSize': '305',
                            'name': 'augusta_ga_10',
                            'recordCount': '141891',
                            'sizeKey': '43367684'},
                           {'averageRecordSize': '328',
                            'name': 'orlando_fl_09',
                            'recordCount': '131260',
                            'sizeKey': '43069457'},
                           {'averageRecordSize': '282',
                            'name': 'columbus_ga_09',
                            'recordCount': '62932',
                            'sizeKey': '17752691'},
                           {'averageRecordSize': '278',
                            'name': 'neworleans_la_08',
                            'recordCount': '199835',
                            'sizeKey': '55638038'},
                           {'averageRecordSize': '278',
                            'name': 'omaha_ne_07',
                            'recordCount': '140418',
                            'sizeKey': '39112092'},
                           {'averageRecordSize': '294',
                            'name': 'poughkeepsie_ny_12',
                            'recordCount': '115295',
                            'sizeKey': '33907860'},
                           {'averageRecordSize': '309',
                            'name': 'charlotte_nc_12',
                            'recordCount': '220728',
                            'sizeKey': '68310527'},
                           {'averageRecordSize': '277',
                            'name': 'kansascity_mo_10',
                            'recordCount': '217167',
                            'sizeKey': '60181733'},
                           {'averageRecordSize': '407',
                            'name': 'washington_dc_12',
                            'recordCount': '40370',
                            'sizeKey': '16472838'},
                           {'averageRecordSize': '344',
                            'name': 'atlanta_ga_08',
                            'recordCount': '41789',
                            'sizeKey': '14410342'},
                           {'averageRecordSize': '284',
                            'name': 'bridgeport_ct_06',
                            'recordCount': '104902',
                            'sizeKey': '29817578'},
                           {'averageRecordSize': '289',
                            'name': 'columbia_sc_09',
                            'recordCount': '61853',
                            'sizeKey': '17937172'},
                           {'averageRecordSize': '302',
                            'name': 'sanantonio_tx_13',
                            'recordCount': '513597',
                            'sizeKey': '155568411'},
                           {'averageRecordSize': '294',
                            'name': 'tucson_az_07',
                            'recordCount': '152548',
                            'sizeKey': '44956993'},
                           {'averageRecordSize': '293',
                            'name': 'indianapolis_in_12',
                            'recordCount': '387999',
                            'sizeKey': '113985977'},
                           {'averageRecordSize': '265',
                            'name': 'syracuse_ny_08',
                            'recordCount': '81519',
                            'sizeKey': '21664878'},
                           {'averageRecordSize': '280',
                            'name': 'coloradosprings_co_06',
                            'recordCount': '108381',
                            'sizeKey': '30373902'},
                           {'averageRecordSize': '332',
                            'name': 'lancaster_pa_10',
                            'recordCount': '73403',
                            'sizeKey': '24408868'},
                           {'averageRecordSize': '281',
                            'name': 'lexington_ky_12',
                            'recordCount': '90510',
                            'sizeKey': '25519182'},
                           {'averageRecordSize': '303',
                            'name': 'shreveport_la_08',
                            'recordCount': '122955',
                            'sizeKey': '37353151'},
                           {'averageRecordSize': '307',
                            'name': 'newyork_ny_13',
                            'recordCount': '1070937',
                            'sizeKey': '329711038'},
                           {'averageRecordSize': '303',
                            'name': 'albany_ny_13',
                            'recordCount': '164978',
                            'sizeKey': '50139844'},
                           {'averageRecordSize': '303',
                            'name': 'bridgeport_ct_13',
                            'recordCount': '110913',
                            'sizeKey': '33617054'},
                           {'averageRecordSize': '253',
                            'name': 'buffalo_ny_08',
                            'recordCount': '298360',
                            'sizeKey': '75600281'},
                           {'averageRecordSize': '269',
                            'name': 'seattle_wa_11',
                            'recordCount': '138104',
                            'sizeKey': '37216766'},
                           {'averageRecordSize': '265',
                            'name': 'pittsburgh_pa_12',
                            'recordCount': '398202',
                            'sizeKey': '105664218'},
                           {'averageRecordSize': '282',
                            'name': 'charleston_wv_09',
                            'recordCount': '54046',
                            'sizeKey': '15275544'},
                           {'averageRecordSize': '300',
                            'name': 'huntsville_al_09',
                            'recordCount': '104122',
                            'sizeKey': '31254812'},
                           {'averageRecordSize': '322',
                            'name': 'pensacola_fl_09',
                            'recordCount': '97179',
                            'sizeKey': '31299078'},
                           {'averageRecordSize': '284',
                            'name': 'stlouis_mo_13',
                            'recordCount': '517103',
                            'sizeKey': '147229372'},
                           {'averageRecordSize': '293',
                            'name': 'tampa_fl_08',
                            'recordCount': '101793',
                            'sizeKey': '29885564'},
                           {'averageRecordSize': '288',
                            'name': 'topeka_ks_08',
                            'recordCount': '70601',
                            'sizeKey': '20341092'},
                           {'averageRecordSize': '276',
                            'name': 'providence_ri_04',
                            'recordCount': '164929',
                            'sizeKey': '45659502'},
                           {'averageRecordSize': '294',
                            'name': 'sacramento_ca_12',
                            'recordCount': '239854',
                            'sizeKey': '70729549'},
                           {'averageRecordSize': '268',
                            'name': 'youngstown_oh_08',
                            'recordCount': '197154',
                            'sizeKey': '52898772'},
                           {'averageRecordSize': '299',
                            'name': 'carsoncity_nv_09',
                            'recordCount': '27006',
                            'sizeKey': '8089251'},
                           {'averageRecordSize': '300',
                            'name': 'coloradosprings_co_13',
                            'recordCount': '177577',
                            'sizeKey': '53452976'},
                           {'averageRecordSize': '288',
                            'name': 'harrisburg_pa_09',
                            'recordCount': '171811',
                            'sizeKey': '49496874'},
                           {'averageRecordSize': '304',
                            'name': 'jacksonville_fl_10',
                            'recordCount': '156647',
                            'sizeKey': '47643046'},
                           {'averageRecordSize': '292',
                            'name': 'pittsburgh_pa_04',
                            'recordCount': '183672',
                            'sizeKey': '53697486'},
                           {'averageRecordSize': '255',
                            'name': 'stlouis_mo_08',
                            'recordCount': '233371',
                            'sizeKey': '59647142'},
                           {'averageRecordSize': '299',
                            'name': 'tallahassee_fl_09',
                            'recordCount': '61968',
                            'sizeKey': '18542164'},
                           {'averageRecordSize': '280',
                            'name': 'mcallen_tx_08',
                            'recordCount': '97965',
                            'sizeKey': '27513547'},
                           {'averageRecordSize': '317',
                            'name': 'sanbernardinoriverside_ca_12',
                            'recordCount': '261248',
                            'sizeKey': '83051331'},
                           {'averageRecordSize': '335',
                            'name': 'sandiego_ca_13',
                            'recordCount': '121639',
                            'sizeKey': '40776290'},
                           {'averageRecordSize': '288',
                            'name': 'indianapolis_in_06',
                            'recordCount': '145320',
                            'sizeKey': '41887068'},
                           {'averageRecordSize': '303',
                            'name': 'minneapolis_mn_12',
                            'recordCount': '752775',
                            'sizeKey': '228392184'},
                           {'averageRecordSize': '288',
                            'name': 'lasvegas_nv_09',
                            'recordCount': '475543',
                            'sizeKey': '136969563'},
                           {'averageRecordSize': '301',
                            'name': 'charleston_sc_10',
                            'recordCount': '39791',
                            'sizeKey': '12010183'},
                           {'averageRecordSize': '285',
                            'name': 'richmond_va_13',
                            'recordCount': '64437',
                            'sizeKey': '18374395'},
                           {'averageRecordSize': '298',
                            'name': 'rochester_ny_14',
                            'recordCount': '119101',
                            'sizeKey': '35512853'},
                           {'averageRecordSize': '271',
                            'name': 'desmoines_ia_10',
                            'recordCount': '149385',
                            'sizeKey': '40582578'},
                           {'averageRecordSize': '285',
                            'name': 'lansing_mi_07',
                            'recordCount': '121708',
                            'sizeKey': '34803858'},
                           {'averageRecordSize': '402',
                            'name': 'batonrouge_la_06',
                            'recordCount': '102329',
                            'sizeKey': '41174433'},
                           {'averageRecordSize': '311',
                            'name': 'charlotte_nc_06',
                            'recordCount': '95913',
                            'sizeKey': '29857014'},
                           {'averageRecordSize': '271',
                            'name': 'chicago_il_12',
                            'recordCount': '1071844',
                            'sizeKey': '291121258'},
                           {'averageRecordSize': '282',
                            'name': 'saltlakecity_ut_12',
                            'recordCount': '214042',
                            'sizeKey': '60407802'},
                           {'averageRecordSize': '314',
                            'name': 'jackson_ms_07',
                            'recordCount': '91891',
                            'sizeKey': '28904321'},
                           {'averageRecordSize': '271',
                            'name': 'newhaven_ct_07',
                            'recordCount': '177767',
                            'sizeKey': '48308089'},
                           {'averageRecordSize': '284',
                            'name': 'amarillo_tx_08',
                            'recordCount': '70472',
                            'sizeKey': '20051787'},
                           {'averageRecordSize': '273',
                            'name': 'cincinnati_oh_10',
                            'recordCount': '204496',
                            'sizeKey': '55905781'},
                           {'averageRecordSize': '305',
                            'name': 'austin_tx_06',
                            'recordCount': '108446',
                            'sizeKey': '33116610'},
                           {'averageRecordSize': '282',
                            'name': 'minneapolis_mn_07',
                            'recordCount': '545711',
                            'sizeKey': '153904864'},
                           {'averageRecordSize': '310',
                            'name': 'sanfrancisco_ca_13',
                            'recordCount': '921012',
                            'sizeKey': '285844206'},
                           {'averageRecordSize': '278',
                            'name': 'helena_mt_07',
                            'recordCount': '26528',
                            'sizeKey': '7387340'},
                           {'averageRecordSize': '263',
                            'name': 'cleveland_oh_12',
                            'recordCount': '450403',
                            'sizeKey': '118898307'},
                           {'averageRecordSize': '275',
                            'name': 'trenton_nj_08',
                            'recordCount': '54743',
                            'sizeKey': '15103325'},
                           {'averageRecordSize': '315',
                            'name': 'austin_tx_12',
                            'recordCount': '86212',
                            'sizeKey': '27172664'},
                           {'averageRecordSize': '277',
                            'name': 'montpelier_vt_09',
                            'recordCount': '12043',
                            'sizeKey': '3346948'},
                           {'averageRecordSize': '382',
                            'name': 'batonrouge_la_12',
                            'recordCount': '104970',
                            'sizeKey': '40138735'},
                           {'averageRecordSize': '319',
                            'name': 'sarasota_fl_09',
                            'recordCount': '142167',
                            'sizeKey': '45460899'},
                           {'averageRecordSize': '280',
                            'name': 'allentown_pa_06',
                            'recordCount': '121875',
                            'sizeKey': '34243372'},
                           {'averageRecordSize': '289',
                            'name': 'sanantonio_tx_08',
                            'recordCount': '440676',
                            'sizeKey': '127738116'},
                           {'averageRecordSize': '487',
                            'name': 'boulder_co_14',
                            'recordCount': '41041',
                            'sizeKey': '20020641'},
                           {'averageRecordSize': '317',
                            'name': 'stockton_ca_10',
                            'recordCount': '110711',
                            'sizeKey': '35195282'},
                           {'averageRecordSize': '281',
                            'name': 'winstonsalem_nc_09',
                            'recordCount': '107924',
                            'sizeKey': '30389558'},
                           {'averageRecordSize': '347',
                            'name': 'corpuschristi_tx_12',
                            'recordCount': '33697',
                            'sizeKey': '11721412'},
                           {'averageRecordSize': '306',
                            'name': 'greensboro_nc_09',
                            'recordCount': '110206',
                            'sizeKey': '33765607'},
                           {'averageRecordSize': '269',
                            'name': 'newark_nj_07',
                            'recordCount': '170068',
                            'sizeKey': '45838685'},
                           {'averageRecordSize': '286',
                            'name': 'toledo_oh_12',
                            'recordCount': '168134',
                            'sizeKey': '48226755'},
                           {'averageRecordSize': '277',
                            'name': 'worcester_ma_09',
                            'recordCount': '72703',
                            'sizeKey': '20188431'},
                           {'averageRecordSize': '326',
                            'name': 'palmbay_fl_10',
                            'recordCount': '225761',
                            'sizeKey': '73801651'},
                           {'averageRecordSize': '299',
                            'name': 'springfield_il_09',
                            'recordCount': '73573',
                            'sizeKey': '22018437'},
                           {'averageRecordSize': '301',
                            'name': 'ftbelvoir_dc_12',
                            'recordCount': '28599',
                            'sizeKey': '8641512'},
                           {'averageRecordSize': '348',
                            'name': 'miami_fl_09',
                            'recordCount': '585213',
                            'sizeKey': '204170564'},
                           {'averageRecordSize': '292',
                            'name': 'toledo_oh_06',
                            'recordCount': '152813',
                            'sizeKey': '44628698'},
                           {'averageRecordSize': '281',
                            'name': 'sandiego_ca_08',
                            'recordCount': '122549',
                            'sizeKey': '34558569'},
                           {'averageRecordSize': '277',
                            'name': 'springfield_ma_07',
                            'recordCount': '114309',
                            'sizeKey': '31694214'},
                           {'averageRecordSize': '329',
                            'name': 'santafe_nm_09',
                            'recordCount': '40828',
                            'sizeKey': '13442635'},
                           {'averageRecordSize': '323',
                            'name': 'bakersfield_ca_10',
                            'recordCount': '161383',
                            'sizeKey': '52274485'},
                           {'averageRecordSize': '285',
                            'name': 'helena_mt_13',
                            'recordCount': '27042',
                            'sizeKey': '7727396'},
                           {'averageRecordSize': '316',
                            'name': 'oxnard_ca_10',
                            'recordCount': '89242',
                            'sizeKey': '28284011'},
                           {'averageRecordSize': '285',
                            'name': 'kansascity_mo_12',
                            'recordCount': '302506',
                            'sizeKey': '86397328'},
                           {'averageRecordSize': '332',
                            'name': 'missionviejo_ca_13',
                            'recordCount': '86122',
                            'sizeKey': '28597480'},
                           {'averageRecordSize': '303',
                            'name': 'newhaven_ct_13',
                            'recordCount': '224298',
                            'sizeKey': '67969105'},
                           {'averageRecordSize': '294',
                            'name': 'philadelphia_pa_07',
                            'recordCount': '648953',
                            'sizeKey': '191291895'},
                           {'averageRecordSize': '289',
                            'name': 'raleighdurham_nc_10',
                            'recordCount': '181532',
                            'sizeKey': '52495335'},
                           {'averageRecordSize': '283',
                            'name': 'louisville_ky_06',
                            'recordCount': '191009',
                            'sizeKey': '54065517'},
                           {'averageRecordSize': '275',
                            'name': 'spokane_wa_08',
                            'recordCount': '157903',
                            'sizeKey': '43574902'},
                           {'averageRecordSize': '297',
                            'name': 'andrewsafb_dc_12',
                            'recordCount': '5822',
                            'sizeKey': '1737472'},
                           {'averageRecordSize': '277',
                            'name': 'augusta_me_08',
                            'recordCount': '17431',
                            'sizeKey': '4841000'},
                           {'averageRecordSize': '284',
                            'name': 'flint_mi_09',
                            'recordCount': '161558',
                            'sizeKey': '46015169'},
                           {'averageRecordSize': '303',
                            'name': 'frankfort_ky_12',
                            'recordCount': '19369',
                            'sizeKey': '5882154'},
                           {'averageRecordSize': '277',
                            'name': 'milwaukee_wi_13',
                            'recordCount': '399572',
                            'sizeKey': '110964968'},
                           {'averageRecordSize': '291',
                            'name': 'bismarck_nd_08',
                            'recordCount': '35108',
                            'sizeKey': '10255719'},
                           {'averageRecordSize': '280',
                            'name': 'cheyenne_wy_08',
                            'recordCount': '34679',
                            'sizeKey': '9737399'},
                           {'averageRecordSize': '269',
                            'name': 'laguardiajfk_ny_07',
                            'recordCount': '310219',
                            'sizeKey': '83558867'},
                           {'averageRecordSize': '371',
                            'name': 'tampa_fl_13',
                            'recordCount': '515492',
                            'sizeKey': '191715675'},
                           {'averageRecordSize': '304',
                            'name': 'boise_id_07',
                            'recordCount': '117058',
                            'sizeKey': '35614823'},
                           {'averageRecordSize': '271',
                            'name': 'columbus_oh_06',
                            'recordCount': '203820',
                            'sizeKey': '55381428'},
                           {'averageRecordSize': '281',
                            'name': 'hartford_ct_06',
                            'recordCount': '117270',
                            'sizeKey': '33048748'},
                           {'averageRecordSize': '310',
                            'name': 'littlerock_ar_08',
                            'recordCount': '102399',
                            'sizeKey': '31774042'},
                           {'averageRecordSize': '605',
                            'name': 'manhattan_ny_07',
                            'recordCount': '36632',
                            'sizeKey': '22175268'},
                           {'averageRecordSize': '288',
                            'name': 'losangeles_ca_07',
                            'recordCount': '2602094',
                            'sizeKey': '749861961'},
                           {'averageRecordSize': '277',
                            'name': 'pierre_sd_08',
                            'recordCount': '7503',
                            'sizeKey': '2089444'},
                           {'averageRecordSize': '260',
                            'name': 'detroit_mi_12',
                            'recordCount': '647001',
                            'sizeKey': '168401862'},
                           {'averageRecordSize': '272',
                            'name': 'rochester_ny_08',
                            'recordCount': '130811',
                            'sizeKey': '35605414'},
                           {'averageRecordSize': '307',
                            'name': 'fresno_ca_06',
                            'recordCount': '185015',
                            'sizeKey': '56810869'},
                           {'averageRecordSize': '299',
                            'name': 'olympia_wa_10',
                            'recordCount': '72859',
                            'sizeKey': '21834125'},
                           {'averageRecordSize': '272',
                            'name': 'louisville_ky_12',
                            'recordCount': '211012',
                            'sizeKey': '57562436'},
                           {'averageRecordSize': '272',
                            'name': 'arnold_mo_06',
                            'recordCount': '23510',
                            'sizeKey': '6413134'},
                           {'averageRecordSize': '334',
                            'name': 'baltimore_md_13',
                            'recordCount': '190005',
                            'sizeKey': '63485009'},
                           {'averageRecordSize': '349',
                            'name': 'neworleans_la_12',
                            'recordCount': '274754',
                            'sizeKey': '95989288'},
                           {'averageRecordSize': '340',
                            'name': 'boise_id_13',
                            'recordCount': '128429',
                            'sizeKey': '43769495'},
                           {'averageRecordSize': '306',
                            'name': 'omaha_ne_13',
                            'recordCount': '265846',
                            'sizeKey': '81578437'},
                           {'averageRecordSize': '328',
                            'name': 'grandrapids_mi_13',
                            'recordCount': '174433',
                            'sizeKey': '57337256'},
                           {'averageRecordSize': '285',
                            'name': 'washington_dc_09',
                            'recordCount': '1186138',
                            'sizeKey': '338285071'},
                           {'averageRecordSize': '290',
                            'name': 'dayton_oh_12',
                            'recordCount': '193235',
                            'sizeKey': '56045235'},
                           {'averageRecordSize': '307',
                            'name': 'lansing_mi_13',
                            'recordCount': '124492',
                            'sizeKey': '38288103'},
                           {'averageRecordSize': '308',
                            'name': 'modesto_ca_10',
                            'recordCount': '79866',
                            'sizeKey': '24681152'},
                           {'averageRecordSize': '314',
                            'name': 'reno_nv_07',
                            'recordCount': '116640',
                            'sizeKey': '36741726'},
                           {'averageRecordSize': '319',
                            'name': 'albuquerque_nm_06',
                            'recordCount': '161739',
                            'sizeKey': '51725911'},
                           {'averageRecordSize': '293',
                            'name': 'dover_de_09',
                            'recordCount': '26328',
                            'sizeKey': '7739615'},
                           {'averageRecordSize': '326',
                            'name': 'houston_tx_10',
                            'recordCount': '540904',
                            'sizeKey': '176348274'},
                           {'averageRecordSize': '330',
                            'name': 'oklahomacity_ok_13',
                            'recordCount': '270013',
                            'sizeKey': '89307226'},
                           {'averageRecordSize': '264',
                            'name': 'richmond_va_08',
                            'recordCount': '51997',
                            'sizeKey': '13780344'},
                           {'averageRecordSize': '288',
                            'name': 'salem_or_08',
                            'recordCount': '83822',
                            'sizeKey': '24180996'},
                           {'averageRecordSize': '314',
                            'name': 'mobile_al_10',
                            'recordCount': '12336',
                            'sizeKey': '3884398'},
                           {'averageRecordSize': '309',
                            'name': 'denver_co_12',
                            'recordCount': '734236',
                            'sizeKey': '227563240'},
                           {'averageRecordSize': '271',
                            'name': 'birmingham_al_08',
                            'recordCount': '76303',
                            'sizeKey': '20708237'},
                           {'averageRecordSize': '265',
                            'name': 'milwaukee_wi_07',
                            'recordCount': '241337',
                            'sizeKey': '64057224'},
                           {'averageRecordSize': '315',
                            'name': 'baltimore_md_08',
                            'recordCount': '145123',
                            'sizeKey': '45735439'},
                           {'averageRecordSize': '295',
                            'name': 'concord_nh_09',
                            'recordCount': '21718',
                            'sizeKey': '6431987'},
                           {'averageRecordSize': '275',
                            'name': 'dayton_oh_06',
                            'recordCount': '131003',
                            'sizeKey': '36075259'},
                           {'averageRecordSize': '281',
                            'name': 'jeffersoncity_mo_08',
                            'recordCount': '30593',
                            'sizeKey': '8621651'},
                           {'averageRecordSize': '302',
                            'name': 'tulsa_ok_08',
                            'recordCount': '238526',
                            'sizeKey': '72251388'},
                           {'averageRecordSize': '378',
                            'name': 'albuquerque_nm_12',
                            'recordCount': '162952',
                            'sizeKey': '61686877'},
                           {'averageRecordSize': '492',
                            'name': 'newyork_ny_05',
                            'recordCount': '141559',
                            'sizeKey': '69741096'},
                           {'averageRecordSize': '335',
                            'name': 'fresno_ca_13',
                            'recordCount': '212227',
                            'sizeKey': '71294022'},
                           {'averageRecordSize': '307',
                            'name': 'montgomery_al_07',
                            'recordCount': '74633',
                            'sizeKey': '22989911'},
                           {'averageRecordSize': '257',
                            'name': 'scranton_pa_08',
                            'recordCount': '94092',
                            'sizeKey': '24235638'},
                           {'averageRecordSize': '292',
                            'name': 'wichita_ks_12',
                            'recordCount': '115740',
                            'sizeKey': '33894037'},
                           {'averageRecordSize': '330',
                            'name': 'atlanta_ga_13',
                            'recordCount': '462468',
                            'sizeKey': '152920479'},
                           {'averageRecordSize': '279',
                            'name': 'norfolk_va_07',
                            'recordCount': '364694',
                            'sizeKey': '101947536'},
                           {'averageRecordSize': '291',
                            'name': 'albany_ny_06',
                            'recordCount': '111078',
                            'sizeKey': '32408514'},
                           {'averageRecordSize': '276',
                            'name': 'lincoln_ne_08',
                            'recordCount': '90377',
                            'sizeKey': '24952120'},
                           {'averageRecordSize': '291',
                            'name': 'oklahomacity_ok_07',
                            'recordCount': '148648',
                            'sizeKey': '43372195'},
                           {'averageRecordSize': '300',
                            'name': 'madison_wi_10',
                            'recordCount': '90018',
                            'sizeKey': '27098362'},
                           {'averageRecordSize': '273',
                            'name': 'columbus_oh_12',
                            'recordCount': '288711',
                            'sizeKey': '78900992'},
                           {'averageRecordSize': '282',
                            'name': 'portland_or_12',
                            'recordCount': '279024',
                            'sizeKey': '78774591'},
                           {'averageRecordSize': '331',
                            'name': 'anaheim_ca_10',
                            'recordCount': '28352',
                            'sizeKey': '9390601'},
                           {'averageRecordSize': '318',
                            'name': 'hartford_ct_13',
                            'recordCount': '126818',
                            'sizeKey': '40414690'}]

      try:
          logger.info(f"Recreating table: {self.pv_rooftops_buildings_table_name}")
          response = self.glue.delete_table(
              DatabaseName=self.database_name,
              Name=self.pv_rooftops_buildings_table_name
          )
      except ClientError as e:
          if e.response['Error']['Code'] == 'EntityNotFoundException':
              logger.debug(r"Skipping table deletion as it does not exist: {self.pv_rooftops_buildings_table_name}")

      logger.info("Creating pv_rooftops buildings table")

      response = self.glue.create_table(
          DatabaseName=self.database_name,
          TableInput={
              'Name': self.pv_rooftops_buildings_table_name,
              'PartitionKeys': [{'Name': 'city_year', 'Type': 'string'}],
              'Retention': 0,
              'Parameters': {'averageRecordSize': '271',
                             'classification': 'parquet',
                             'compressionType': 'none',
                             'objectCount': '168',
                             'recordCount': '35097591',
                             'sizeKey': '10417280616',
                             'typeOfData': 'file'},
              'StorageDescriptor': {'BucketColumns': [],
                               'Columns': [{'Name': 'gid', 'Type': 'bigint'},
                                           {'Name': 'bldg_fid',
                                            'Type': 'bigint'},
                                           {'Name': 'the_geom_96703',
                                            'Type': 'string'},
                                           {'Name': 'the_geom_4326',
                                            'Type': 'string'},
                                           {'Name': 'city', 'Type': 'string'},
                                           {'Name': 'state',
                                            'Type': 'string'},
                                           {'Name': 'year', 'Type': 'bigint'},
                                           {'Name': 'region_id',
                                            'Type': 'bigint'},
                                           {'Name': '__index_level_0__',
                                            'Type': 'bigint'}],
                               'Compressed': False,
                               'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                               'Location': f'{self.pv_rooftops_bucket}/buildings/',
                               'NumberOfBuckets': -1,
                               'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                               'Parameters': {'CrawlerSchemaDeserializerVersion': '1.0',
                                              'CrawlerSchemaSerializerVersion': '1.0',
                                              'UPDATED_BY_CRAWLER': 'pv_rooftop_buildings',
                                              'averageRecordSize': '271',
                                              'classification': 'parquet',
                                              'compressionType': 'none',
                                              'objectCount': '168',
                                              'recordCount': '35097591',
                                              'sizeKey': '10417280616',
                                              'typeOfData': 'file'},
                               'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                             'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                               'SortColumns': [],
                               'StoredAsSubDirectories': False},
         'TableType': 'EXTERNAL_TABLE'
          }
      )

      #pprint(response)

      logger.info("Creating pv_rooftops buildings partitions")

      count = 0
      templateArray = []
      for partition in partitionsArray:
          #pprint(partition)
          count = count + 1
          thisTemplate = self.get_pv_rooftop_bldg_partition_template()
          thisTemplate['StorageDescriptor']['Location'] = f"{self.pv_rooftops_bucket}/buildings/{partition['name']}/"
          thisTemplate['StorageDescriptor']['Parameters']['averageRecordSize'] = partition['averageRecordSize']
          thisTemplate['StorageDescriptor']['Parameters']['recordCount'] = partition['recordCount']
          thisTemplate['StorageDescriptor']['Parameters']['sizeKey'] = partition['sizeKey']
          thisTemplate['Values'][0] = partition['name']
          templateArray.append(thisTemplate)

          #pprint(templateArray)
          #print(count)
          if count%10 == 0:
              #print('submitting')
              logger.info("Submitting pv_rooftop building partitions batch")
              #pprint(templateArray)
              response2 = self.glue.batch_create_partition(
                  DatabaseName = self.database_name,
                  TableName = self.pv_rooftops_buildings_table_name,
                  PartitionInputList = templateArray
              )
              #pprint(response2)
              templateArray = []

      if count%10 != 0:
          logger.info("Submitting pv_rooftop building partitions batch")
          response2 = self.glue.batch_create_partition(
              DatabaseName=self.database_name,
              TableName=self.pv_rooftops_buildings_table_name,
              PartitionInputList=templateArray
          )
          #pprint(response2)


    def create_pv_rooftop_rasd_table(self):

      partitionsArray = [{'averageRecordSize': '49082739',
            'name': 'sanbernardinoriverside_ca_12',
            'recordCount': '1',
            'sizeKey': '49085631'},
           {'averageRecordSize': '33344154',
            'name': 'albuquerque_nm_12',
            'recordCount': '1',
            'sizeKey': '33347034'},
           {'averageRecordSize': '23563518',
            'name': 'trenton_nj_08',
            'recordCount': '1',
            'sizeKey': '23566382'},
           {'averageRecordSize': '20845284',
            'name': 'sandiego_ca_08',
            'recordCount': '1',
            'sizeKey': '20848156'},
           {'averageRecordSize': '24375559',
            'name': 'augusta_me_08',
            'recordCount': '1',
            'sizeKey': '24378423'},
           {'averageRecordSize': '42818785',
            'name': 'providence_ri_12',
            'recordCount': '1',
            'sizeKey': '42821661'},
           {'averageRecordSize': '24514003',
            'name': 'charleston_wv_09',
            'recordCount': '1',
            'sizeKey': '24516879'},
           {'averageRecordSize': '19612568',
            'name': 'austin_tx_12',
            'recordCount': '1',
            'sizeKey': '19615428'},
           {'averageRecordSize': '31779978',
            'name': 'neworleans_la_08',
            'recordCount': '1',
            'sizeKey': '31782858'},
           {'averageRecordSize': '20431018',
            'name': 'sandiego_ca_13',
            'recordCount': '1',
            'sizeKey': '20433890'},
           {'averageRecordSize': '20628689',
            'name': 'rochester_ny_14',
            'recordCount': '1',
            'sizeKey': '20631561'},
           {'averageRecordSize': '126742139',
            'name': 'sacramento_ca_12',
            'recordCount': '1',
            'sizeKey': '126745015'},
           {'averageRecordSize': '27458931',
            'name': 'jeffersoncity_mo_08',
            'recordCount': '1',
            'sizeKey': '27461823'},
           {'averageRecordSize': '23851303',
            'name': 'louisville_ky_06',
            'recordCount': '1',
            'sizeKey': '23854179'},
           {'averageRecordSize': '44271263',
            'name': 'milwaukee_wi_13',
            'recordCount': '1',
            'sizeKey': '44274135'},
           {'averageRecordSize': '42875317',
            'name': 'richmond_va_13',
            'recordCount': '1',
            'sizeKey': '42878185'},
           {'averageRecordSize': '1726',
            'name': 'tulsa_ok_08',
            'recordCount': '1',
            'sizeKey': '6028'},
           {'averageRecordSize': '29683149',
            'name': 'corpuschristi_tx_12',
            'recordCount': '1',
            'sizeKey': '29686041'},
           {'averageRecordSize': '2667',
            'name': 'atlanta_ga_13',
            'recordCount': '1',
            'sizeKey': '8349'},
           {'averageRecordSize': '25518001',
            'name': 'tampa_fl_08',
            'recordCount': '1',
            'sizeKey': '25520857'},
           {'averageRecordSize': '31616468',
            'name': 'hartford_ct_13',
            'recordCount': '1',
            'sizeKey': '31619336'},
           {'averageRecordSize': '32609564',
            'name': 'coloradosprings_co_13',
            'recordCount': '1',
            'sizeKey': '32612464'},
           {'averageRecordSize': '33887271',
            'name': 'lansing_mi_13',
            'recordCount': '1',
            'sizeKey': '33890135'},
           {'averageRecordSize': '37529162',
            'name': 'grandrapids_mi_13',
            'recordCount': '1',
            'sizeKey': '37532046'},
           {'averageRecordSize': '51654639',
            'name': 'pittsburgh_pa_04',
            'recordCount': '1',
            'sizeKey': '51657515'},
           {'averageRecordSize': '24933840',
            'name': 'austin_tx_06',
            'recordCount': '1',
            'sizeKey': '24936700'},
           {'averageRecordSize': '68419413',
            'name': 'denver_co_12',
            'recordCount': '1',
            'sizeKey': '68422273'},
           {'averageRecordSize': '31313807',
            'name': 'newyork_ny_05',
            'recordCount': '1',
            'sizeKey': '31316675'},
           {'averageRecordSize': '33025501',
            'name': 'albany_ny_13',
            'recordCount': '1',
            'sizeKey': '33028361'},
           {'averageRecordSize': '13015143',
            'name': 'arnold_mo_06',
            'recordCount': '1',
            'sizeKey': '13018003'},
           {'averageRecordSize': '21241642',
            'name': 'worcester_ma_09',
            'recordCount': '1',
            'sizeKey': '21244514'},
           {'averageRecordSize': '38021145',
            'name': 'oklahomacity_ok_13',
            'recordCount': '1',
            'sizeKey': '38024033'},
           {'averageRecordSize': '24542978',
            'name': 'boise_id_07',
            'recordCount': '1',
            'sizeKey': '24545834'},
           {'averageRecordSize': '70315465',
            'name': 'newhaven_ct_07',
            'recordCount': '1',
            'sizeKey': '70318337'},
           {'averageRecordSize': '27623185',
            'name': 'portland_or_12',
            'recordCount': '1',
            'sizeKey': '27626053'},
           {'averageRecordSize': '16656770',
            'name': 'ftbelvoir_dc_12',
            'recordCount': '1',
            'sizeKey': '16659646'},
           {'averageRecordSize': '32028392',
            'name': 'springfield_ma_07',
            'recordCount': '1',
            'sizeKey': '32031272'},
           {'averageRecordSize': '24098174',
            'name': 'tucson_az_07',
            'recordCount': '1',
            'sizeKey': '24101034'},
           {'averageRecordSize': '21305012',
            'name': 'washington_dc_12',
            'recordCount': '1',
            'sizeKey': '21307888'},
           {'averageRecordSize': '30097166',
            'name': 'toledo_oh_06',
            'recordCount': '1',
            'sizeKey': '30100026'},
           {'averageRecordSize': '70157413',
            'name': 'baltimore_md_08',
            'recordCount': '1',
            'sizeKey': '70160285'},
           {'averageRecordSize': '81453587',
            'name': 'norfolk_va_07',
            'recordCount': '1',
            'sizeKey': '81456451'},
           {'averageRecordSize': '24129028',
            'name': 'batonrouge_la_12',
            'recordCount': '1',
            'sizeKey': '24131908'},
           {'averageRecordSize': '24325772',
            'name': 'montgomery_al_07',
            'recordCount': '1',
            'sizeKey': '24328648'},
           {'averageRecordSize': '34298778',
            'name': 'spokane_wa_08',
            'recordCount': '1',
            'sizeKey': '34301642'},
           {'averageRecordSize': '84365681',
            'name': 'chicago_il_12',
            'recordCount': '1',
            'sizeKey': '84368545'},
           {'averageRecordSize': '60364460',
            'name': 'newhaven_ct_13',
            'recordCount': '1',
            'sizeKey': '60367332'},
           {'averageRecordSize': '33095329',
            'name': 'jackson_ms_07',
            'recordCount': '1',
            'sizeKey': '33098193'},
           {'averageRecordSize': '72980127',
            'name': 'philadelphia_pa_07',
            'recordCount': '1',
            'sizeKey': '72983011'},
           {'averageRecordSize': '18983307',
            'name': 'lexington_ky_12',
            'recordCount': '1',
            'sizeKey': '18986179'},
           {'averageRecordSize': '48042800',
            'name': 'minneapolis_mn_07',
            'recordCount': '1',
            'sizeKey': '48045680'},
           {'averageRecordSize': '29882994',
            'name': 'desmoines_ia_10',
            'recordCount': '1',
            'sizeKey': '29885870'},
           {'averageRecordSize': '19533644',
            'name': 'syracuse_ny_08',
            'recordCount': '1',
            'sizeKey': '19536512'},
           {'averageRecordSize': '29501120',
            'name': 'bakersfield_ca_10',
            'recordCount': '1',
            'sizeKey': '29504000'},
           {'averageRecordSize': '25462436',
            'name': 'madison_wi_10',
            'recordCount': '1',
            'sizeKey': '25465300'},
           {'averageRecordSize': '46263173',
            'name': 'detroit_mi_12',
            'recordCount': '1',
            'sizeKey': '46266037'},
           {'averageRecordSize': '19604861',
            'name': 'newark_nj_07',
            'recordCount': '1',
            'sizeKey': '19607721'},
           {'averageRecordSize': '407196709',
            'name': 'kansascity_mo_10',
            'recordCount': '1',
            'sizeKey': '407199642'},
           {'averageRecordSize': '23800994',
            'name': 'oklahomacity_ok_07',
            'recordCount': '1',
            'sizeKey': '23803882'},
           {'averageRecordSize': '41163186',
            'name': 'littlerock_ar_08',
            'recordCount': '1',
            'sizeKey': '41166066'},
           {'averageRecordSize': '18318422',
            'name': 'montpelier_vt_09',
            'recordCount': '1',
            'sizeKey': '18321298'},
           {'averageRecordSize': '31412587',
            'name': 'springfield_il_09',
            'recordCount': '1',
            'sizeKey': '31415467'},
           {'averageRecordSize': '40751788',
            'name': 'lasvegas_nv_09',
            'recordCount': '1',
            'sizeKey': '40754660'},
           {'averageRecordSize': '62570914',
            'name': 'cleveland_oh_12',
            'recordCount': '1',
            'sizeKey': '62573786'},
           {'averageRecordSize': '84468484',
            'name': 'minneapolis_mn_12',
            'recordCount': '1',
            'sizeKey': '84471364'},
           {'averageRecordSize': '41067685',
            'name': 'omaha_ne_13',
            'recordCount': '1',
            'sizeKey': '41070541'},
           {'averageRecordSize': '28996151',
            'name': 'saltlakecity_ut_12',
            'recordCount': '1',
            'sizeKey': '28999043'},
           {'averageRecordSize': '79452253',
            'name': 'houston_tx_10',
            'recordCount': '1',
            'sizeKey': '79455117'},
           {'averageRecordSize': '28565502',
            'name': 'laguardiajfk_ny_07',
            'recordCount': '1',
            'sizeKey': '28568390'},
           {'averageRecordSize': '142759762',
            'name': 'washington_dc_09',
            'recordCount': '1',
            'sizeKey': '142762677'},
           {'averageRecordSize': '62598914',
            'name': 'baltimore_md_13',
            'recordCount': '1',
            'sizeKey': '62601786'},
           {'averageRecordSize': '24053157',
            'name': 'albuquerque_nm_06',
            'recordCount': '1',
            'sizeKey': '24056037'},
           {'averageRecordSize': '34793015',
            'name': 'charlotte_nc_12',
            'recordCount': '1',
            'sizeKey': '34795887'},
           {'averageRecordSize': '24105411',
            'name': 'louisville_ky_12',
            'recordCount': '1',
            'sizeKey': '24108287'},
           {'averageRecordSize': '2667',
            'name': 'atlanta_ga_08',
            'recordCount': '1',
            'sizeKey': '8349'},
           {'averageRecordSize': '129839099',
            'name': 'boulder_co_14',
            'recordCount': '1',
            'sizeKey': '129841963'},
           {'averageRecordSize': '24949351',
            'name': 'bridgeport_ct_06',
            'recordCount': '1',
            'sizeKey': '24952227'},
           {'averageRecordSize': '66142179',
            'name': 'chicago_il_08',
            'recordCount': '1',
            'sizeKey': '66145043'},
           {'averageRecordSize': '12395769',
            'name': 'modesto_ca_10',
            'recordCount': '1',
            'sizeKey': '12398633'},
           {'averageRecordSize': '11770210',
            'name': 'pierre_sd_08',
            'recordCount': '1',
            'sizeKey': '11773070'},
           {'averageRecordSize': '44982752',
            'name': 'pittsburgh_pa_12',
            'recordCount': '1',
            'sizeKey': '44985628'},
           {'averageRecordSize': '17138294',
            'name': 'frankfort_ky_12',
            'recordCount': '1',
            'sizeKey': '17141166'},
           {'averageRecordSize': '28314315',
            'name': 'oxnard_ca_10',
            'recordCount': '1',
            'sizeKey': '28317175'},
           {'averageRecordSize': '45988287',
            'name': 'harrisburg_pa_09',
            'recordCount': '1',
            'sizeKey': '45991163'},
           {'averageRecordSize': '23291921',
            'name': 'pensacola_fl_09',
            'recordCount': '1',
            'sizeKey': '23294793'},
           {'averageRecordSize': '22806777',
            'name': 'wichita_ks_12',
            'recordCount': '1',
            'sizeKey': '22809641'},
           {'averageRecordSize': '60157693',
            'name': 'jacksonville_fl_10',
            'recordCount': '1',
            'sizeKey': '60160577'},
           {'averageRecordSize': '51646660',
            'name': 'poughkeepsie_ny_12',
            'recordCount': '1',
            'sizeKey': '51649544'},
           {'averageRecordSize': '25202525',
            'name': 'boise_id_13',
            'recordCount': '1',
            'sizeKey': '25205381'},
           {'averageRecordSize': '22063402',
            'name': 'lincoln_ne_08',
            'recordCount': '1',
            'sizeKey': '22066266'},
           {'averageRecordSize': '81506240',
            'name': 'newyork_ny_13',
            'recordCount': '1',
            'sizeKey': '81509108'},
           {'averageRecordSize': '68382475',
            'name': 'providence_ri_04',
            'recordCount': '1',
            'sizeKey': '68385351'},
           {'averageRecordSize': '62187320',
            'name': 'sarasota_fl_09',
            'recordCount': '1',
            'sizeKey': '62190188'},
           {'averageRecordSize': '32680214',
            'name': 'cincinnati_oh_10',
            'recordCount': '1',
            'sizeKey': '32683090'},
           {'averageRecordSize': '28427245',
            'name': 'dayton_oh_06',
            'recordCount': '1',
            'sizeKey': '28430105'},
           {'averageRecordSize': '42979837',
            'name': 'lansing_mi_07',
            'recordCount': '1',
            'sizeKey': '42982701'},
           {'averageRecordSize': '23960815',
            'name': 'columbus_oh_06',
            'recordCount': '1',
            'sizeKey': '23963683'},
           {'averageRecordSize': '134148887',
            'name': 'toledo_oh_12',
            'recordCount': '1',
            'sizeKey': '134151747'},
           {'averageRecordSize': '21161863',
            'name': 'cheyenne_wy_08',
            'recordCount': '1',
            'sizeKey': '21164731'},
           {'averageRecordSize': '23845619',
            'name': 'indianapolis_in_06',
            'recordCount': '1',
            'sizeKey': '23848503'},
           {'averageRecordSize': '17961663',
            'name': 'missionviejo_ca_13',
            'recordCount': '1',
            'sizeKey': '17964551'},
           {'averageRecordSize': '43323021',
            'name': 'elpaso_tx_07',
            'recordCount': '1',
            'sizeKey': '43325885'},
           {'averageRecordSize': '32910027',
            'name': 'columbus_oh_12',
            'recordCount': '1',
            'sizeKey': '32912895'},
           {'averageRecordSize': '39221696',
            'name': 'lancaster_pa_10',
            'recordCount': '1',
            'sizeKey': '39224568'},
           {'averageRecordSize': '28606073',
            'name': 'stockton_ca_10',
            'recordCount': '1',
            'sizeKey': '28608941'},
           {'averageRecordSize': '23289820',
            'name': 'tallahassee_fl_09',
            'recordCount': '1',
            'sizeKey': '23292700'},
           {'averageRecordSize': '42319654',
            'name': 'omaha_ne_07',
            'recordCount': '1',
            'sizeKey': '42322510'},
           {'averageRecordSize': '54131311',
            'name': 'miami_fl_09',
            'recordCount': '1',
            'sizeKey': '54134167'},
           {'averageRecordSize': '23608940',
            'name': 'rochester_ny_08',
            'recordCount': '1',
            'sizeKey': '23611812'},
           {'averageRecordSize': '35838945',
            'name': 'milwaukee_wi_07',
            'recordCount': '1',
            'sizeKey': '35841817'},
           {'averageRecordSize': '111486084',
            'name': 'palmbay_fl_10',
            'recordCount': '1',
            'sizeKey': '111488952'},
           {'averageRecordSize': '21571958',
            'name': 'birmingham_al_08',
            'recordCount': '1',
            'sizeKey': '21574834'},
           {'averageRecordSize': '34073018',
            'name': 'huntsville_al_09',
            'recordCount': '1',
            'sizeKey': '34075894'},
           {'averageRecordSize': '49459327',
            'name': 'neworleans_la_12',
            'recordCount': '1',
            'sizeKey': '49462207'},
           {'averageRecordSize': '133468336',
            'name': 'fortwayne_in_08',
            'recordCount': '1',
            'sizeKey': '133471212'},
           {'averageRecordSize': '43719252',
            'name': 'albany_ny_06',
            'recordCount': '1',
            'sizeKey': '43722112'},
           {'averageRecordSize': '31331676',
            'name': 'hartford_ct_06',
            'recordCount': '1',
            'sizeKey': '31334544'},
           {'averageRecordSize': '24228405',
            'name': 'bridgeport_ct_13',
            'recordCount': '1',
            'sizeKey': '24231281'},
           {'averageRecordSize': '32123165',
            'name': 'reno_nv_07',
            'recordCount': '1',
            'sizeKey': '32126017'},
           {'averageRecordSize': '40334772',
            'name': 'shreveport_la_08',
            'recordCount': '1',
            'sizeKey': '40337648'},
           {'averageRecordSize': '66964450',
            'name': 'stlouis_mo_13',
            'recordCount': '1',
            'sizeKey': '66967318'},
           {'averageRecordSize': '27192391',
            'name': 'greensboro_nc_09',
            'recordCount': '1',
            'sizeKey': '27195267'},
           {'averageRecordSize': '46714402',
            'name': 'orlando_fl_09',
            'recordCount': '1',
            'sizeKey': '46717266'},
           {'averageRecordSize': '31676946',
            'name': 'richmond_va_08',
            'recordCount': '1',
            'sizeKey': '31679814'},
           {'averageRecordSize': '60980831',
            'name': 'buffalo_ny_08',
            'recordCount': '1',
            'sizeKey': '60983695'},
           {'averageRecordSize': '35584677',
            'name': 'flint_mi_09',
            'recordCount': '1',
            'sizeKey': '35587533'},
           {'averageRecordSize': '108103500',
            'name': 'sanfrancisco_ca_13',
            'recordCount': '1',
            'sizeKey': '108106388'},
           {'averageRecordSize': '8283816',
            'name': 'anaheim_ca_10',
            'recordCount': '1',
            'sizeKey': '8286678'},
           {'averageRecordSize': '17743915',
            'name': 'charleston_sc_10',
            'recordCount': '1',
            'sizeKey': '17746791'},
           {'averageRecordSize': '46365929',
            'name': 'columbia_sc_09',
            'recordCount': '1',
            'sizeKey': '46368797'},
           {'averageRecordSize': '58788904',
            'name': 'sanantonio_tx_13',
            'recordCount': '1',
            'sizeKey': '58791784'},
           {'averageRecordSize': '27798038',
            'name': 'topeka_ks_08',
            'recordCount': '1',
            'sizeKey': '27800898'},
           {'averageRecordSize': '37961816',
            'name': 'olympia_wa_10',
            'recordCount': '1',
            'sizeKey': '37964680'},
           {'averageRecordSize': '18740610',
            'name': 'manhattan_ny_07',
            'recordCount': '1',
            'sizeKey': '18743482'},
           {'averageRecordSize': '28482076',
            'name': 'stlouis_mo_08',
            'recordCount': '1',
            'sizeKey': '28484944'},
           {'averageRecordSize': '22681095',
            'name': 'bismarck_nd_08',
            'recordCount': '1',
            'sizeKey': '22683963'},
           {'averageRecordSize': '42756515',
            'name': 'indianapolis_in_12',
            'recordCount': '1',
            'sizeKey': '42759399'},
           {'averageRecordSize': '66109230',
            'name': 'sanantonio_tx_08',
            'recordCount': '1',
            'sizeKey': '66112110'},
           {'averageRecordSize': '50201957',
            'name': 'scranton_pa_08',
            'recordCount': '1',
            'sizeKey': '50204825'},
           {'averageRecordSize': '20479316',
            'name': 'helena_mt_13',
            'recordCount': '1',
            'sizeKey': '20482176'},
           {'averageRecordSize': '32609728',
            'name': 'seattle_wa_11',
            'recordCount': '1',
            'sizeKey': '32612592'},
           {'averageRecordSize': '39360175',
            'name': 'allentown_pa_06',
            'recordCount': '1',
            'sizeKey': '39363047'},
           {'averageRecordSize': '25708576',
            'name': 'concord_nh_09',
            'recordCount': '1',
            'sizeKey': '25711440'},
           {'averageRecordSize': '26417565',
            'name': 'santafe_nm_09',
            'recordCount': '1',
            'sizeKey': '26420433'},
           {'averageRecordSize': '27920080',
            'name': 'fresno_ca_13',
            'recordCount': '1',
            'sizeKey': '27922940'},
           {'averageRecordSize': '23962114',
            'name': 'springfield_ma_13',
            'recordCount': '1',
            'sizeKey': '23964994'},
           {'averageRecordSize': '26874279',
            'name': 'winstonsalem_nc_09',
            'recordCount': '1',
            'sizeKey': '26877167'},
           {'averageRecordSize': '59811503',
            'name': 'augusta_ga_10',
            'recordCount': '1',
            'sizeKey': '59814367'},
           {'averageRecordSize': '36880968',
            'name': 'coloradosprings_co_06',
            'recordCount': '1',
            'sizeKey': '36883868'},
           {'averageRecordSize': '25313859',
            'name': 'lubbock_tx_08',
            'recordCount': '1',
            'sizeKey': '25316723'},
           {'averageRecordSize': '22279148',
            'name': 'columbus_ga_09',
            'recordCount': '1',
            'sizeKey': '22282016'},
           {'averageRecordSize': '28651502',
            'name': 'fresno_ca_06',
            'recordCount': '1',
            'sizeKey': '28654362'},
           {'averageRecordSize': '35061872',
            'name': 'kansascity_mo_12',
            'recordCount': '1',
            'sizeKey': '35064752'},
           {'averageRecordSize': '31430099',
            'name': 'dayton_oh_12',
            'recordCount': '1',
            'sizeKey': '31432959'},
           {'averageRecordSize': '17852897',
            'name': 'dover_de_09',
            'recordCount': '1',
            'sizeKey': '17855753'},
           {'averageRecordSize': '23258417',
            'name': 'mcallen_tx_08',
            'recordCount': '1',
            'sizeKey': '23261281'},
           {'averageRecordSize': '127194075',
            'name': 'losangeles_ca_07',
            'recordCount': '1',
            'sizeKey': '127196955'},
           {'averageRecordSize': '22727781',
            'name': 'amarillo_tx_08',
            'recordCount': '1',
            'sizeKey': '22730649'},
           {'averageRecordSize': '22507524',
            'name': 'helena_mt_07',
            'recordCount': '1',
            'sizeKey': '22510384'},
           {'averageRecordSize': '21847594',
            'name': 'carsoncity_nv_09',
            'recordCount': '1',
            'sizeKey': '21850474'},
           {'averageRecordSize': '24503078',
            'name': 'charlotte_nc_06',
            'recordCount': '1',
            'sizeKey': '24505950'},
           {'averageRecordSize': '44246739',
            'name': 'youngstown_oh_08',
            'recordCount': '1',
            'sizeKey': '44249615'},
           {'averageRecordSize': '24047127',
            'name': 'batonrouge_la_06',
            'recordCount': '1',
            'sizeKey': '24050007'},
           {'averageRecordSize': '9340466',
            'name': 'mobile_al_10',
            'recordCount': '1',
            'sizeKey': '9343326'},
           {'averageRecordSize': '58219018',
            'name': 'raleighdurham_nc_10',
            'recordCount': '1',
            'sizeKey': '58221910'},
           {'averageRecordSize': '21866486',
            'name': 'salem_or_08',
            'recordCount': '1',
            'sizeKey': '21869342'}]


      try:
          logger.info(f"Recreating table: {self.pv_rooftops_rasd_table_name}")
          response = self.glue.delete_table(
              DatabaseName=self.database_name,
              Name=self.pv_rooftops_rasd_table_name
          )
      except ClientError as e:
          if e.response['Error']['Code'] == 'EntityNotFoundException':
              logger.debug(r"Skipping table deletion as it does not exist: {self.pv_rooftops_rasd_table_name}")

      logger.info("Creating pv_rooftops rasd table")

      response = self.glue.create_table(
          DatabaseName=self.database_name,
          TableInput={
              'Name': self.pv_rooftops_rasd_table_name,
              'PartitionKeys': [{'Name': 'city_year', 'Type': 'string'}],
              'Retention': 0,
              'Parameters': {'averageRecordSize': '41242956',
                              'classification': 'parquet',
                              'compressionType': 'none',
                              'objectCount': '166',
                              'recordCount': '166',
                              'sizeKey': '6846821391',
                              'typeOfData': 'file'},
              'StorageDescriptor': {'BucketColumns': [],
                               'Columns': [{'Name': 'gid', 'Type': 'bigint'},
                                           {'Name': 'the_geom_96703',
                                            'Type': 'string'},
                                           {'Name': 'the_geom_4326',
                                            'Type': 'string'},
                                           {'Name': 'city', 'Type': 'string'},
                                           {'Name': 'state',
                                            'Type': 'string'},
                                           {'Name': 'year', 'Type': 'bigint'},
                                           {'Name': 'region_id',
                                            'Type': 'bigint'},
                                           {'Name': 'serial_id',
                                            'Type': 'bigint'},
                                           {'Name': '__index_level_0__',
                                            'Type': 'bigint'}],
                               'Compressed': False,
                               'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                               'Location': f'{self.pv_rooftops_bucket}/rasd/',
                               'NumberOfBuckets': -1,
                               'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                               'Parameters': {
                                              'averageRecordSize': '41242956',
                                              'classification': 'parquet',
                                              'compressionType': 'none',
                                              'objectCount': '166',
                                              'recordCount': '166',
                                              'sizeKey': '6846821391',
                                              'typeOfData': 'file'},
                               'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                             'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                               'SortColumns': [],
                               'StoredAsSubDirectories': False},
         'TableType': 'EXTERNAL_TABLE'
          }
      )

      #pprint(response)

      logger.info("Creating pv_rooftops rasd partitions")

      count = 0
      templateArray = []
      for partition in partitionsArray:
          #pprint(partition)
          count = count + 1
          thisTemplate = self.get_pv_rooftop_rasd_partition_template()
          thisTemplate['StorageDescriptor']['Location'] = f"{self.pv_rooftops_bucket}/rasd/{partition['name']}/"
          thisTemplate['StorageDescriptor']['Parameters']['averageRecordSize'] = partition['averageRecordSize']
          thisTemplate['StorageDescriptor']['Parameters']['recordCount'] = partition['recordCount']
          thisTemplate['StorageDescriptor']['Parameters']['sizeKey'] = partition['sizeKey']
          thisTemplate['Values'][0] = partition['name']
          templateArray.append(thisTemplate)

          #pprint(templateArray)
          #print(count)
          if count%10 == 0:
              #print('submitting')
              logger.info("Submitting pv_rooftop rasd partitions batch")
              #pprint(templateArray)
              response2 = self.glue.batch_create_partition(
                  DatabaseName = self.database_name,
                  TableName = self.pv_rooftops_rasd_table_name,
                  PartitionInputList = templateArray
              )
              #pprint(response2)
              templateArray = []

      if count%10 != 0:
          logger.info("Submitting pv_rooftop rasd partitions batch")
          response2 = self.glue.batch_create_partition(
              DatabaseName=self.database_name,
              TableName=self.pv_rooftops_rasd_table_name,
              PartitionInputList=templateArray
          )
          #pprint(response2)

    def create_pv_rooftop_aspects_table(self):

      partitionsArray = [{'averageRecordSize': '374',
                        'name': 'richmond_va_13',
                        'recordCount': '877538',
                        'sizeKey': '328844037'},
                       {'averageRecordSize': '430',
                        'name': 'tampa_fl_08',
                        'recordCount': '1318923',
                        'sizeKey': '567989424'},
                       {'averageRecordSize': '446',
                        'name': 'jacksonville_fl_10',
                        'recordCount': '1903897',
                        'sizeKey': '849241451'},
                       {'averageRecordSize': '367',
                        'name': 'pittsburgh_pa_12',
                        'recordCount': '4599657',
                        'sizeKey': '1689121748'},
                       {'averageRecordSize': '379',
                        'name': 'birmingham_al_08',
                        'recordCount': '1063451',
                        'sizeKey': '403950052'},
                       {'averageRecordSize': '410',
                        'name': 'kansascity_mo_10',
                        'recordCount': '2603923',
                        'sizeKey': '1067691606'},
                       {'averageRecordSize': '371',
                        'name': 'manhattan_ny_07',
                        'recordCount': '1841024',
                        'sizeKey': '684185168'},
                       {'averageRecordSize': '471',
                        'name': 'newark_nj_07',
                        'recordCount': '1595590',
                        'sizeKey': '752965147'},
                       {'averageRecordSize': '507',
                        'name': 'neworleans_la_12',
                        'recordCount': '3727682',
                        'sizeKey': '1890904226'},
                       {'averageRecordSize': '460',
                        'name': 'pensacola_fl_09',
                        'recordCount': '1319307',
                        'sizeKey': '607169481'},
                       {'averageRecordSize': '466',
                        'name': 'albany_ny_13',
                        'recordCount': '2252727',
                        'sizeKey': '1050451370'},
                       {'averageRecordSize': '352',
                        'name': 'tallahassee_fl_09',
                        'recordCount': '967642',
                        'sizeKey': '340631299'},
                       {'averageRecordSize': '418',
                        'name': 'tucson_az_07',
                        'recordCount': '1923240',
                        'sizeKey': '805832008'},
                       {'averageRecordSize': '480',
                        'name': 'harrisburg_pa_09',
                        'recordCount': '2435637',
                        'sizeKey': '1169373132'},
                       {'averageRecordSize': '398',
                        'name': 'frankfort_ky_12',
                        'recordCount': '272331',
                        'sizeKey': '108589566'},
                       {'averageRecordSize': '415',
                        'name': 'desmoines_ia_10',
                        'recordCount': '1685390',
                        'sizeKey': '700292341'},
                       {'averageRecordSize': '348',
                        'name': 'kansascity_mo_12',
                        'recordCount': '3619559',
                        'sizeKey': '1260064257'},
                       {'averageRecordSize': '462',
                        'name': 'batonrouge_la_06',
                        'recordCount': '1612206',
                        'sizeKey': '745837342'},
                       {'averageRecordSize': '411',
                        'name': 'minneapolis_mn_12',
                        'recordCount': '10166502',
                        'sizeKey': '4182879874'},
                       {'averageRecordSize': '509',
                        'name': 'neworleans_la_08',
                        'recordCount': '2425437',
                        'sizeKey': '1236236659'},
                       {'averageRecordSize': '442',
                        'name': 'omaha_ne_07',
                        'recordCount': '1622952',
                        'sizeKey': '718544295'},
                       {'averageRecordSize': '457',
                        'name': 'washington_dc_09',
                        'recordCount': '17827108',
                        'sizeKey': '8161078499'},
                       {'averageRecordSize': '437',
                        'name': 'dayton_oh_06',
                        'recordCount': '1547047',
                        'sizeKey': '677291538'},
                       {'averageRecordSize': '432',
                        'name': 'hartford_ct_06',
                        'recordCount': '1515433',
                        'sizeKey': '655074942'},
                       {'averageRecordSize': '359',
                        'name': 'coloradosprings_co_13',
                        'recordCount': '2474754',
                        'sizeKey': '890822209'},
                       {'averageRecordSize': '456',
                        'name': 'oklahomacity_ok_13',
                        'recordCount': '3683783',
                        'sizeKey': '1682258239'},
                       {'averageRecordSize': '441',
                        'name': 'pittsburgh_pa_04',
                        'recordCount': '2488602',
                        'sizeKey': '1097790513'},
                       {'averageRecordSize': '474',
                        'name': 'richmond_va_08',
                        'recordCount': '674755',
                        'sizeKey': '320350409'},
                       {'averageRecordSize': '375',
                        'name': 'stlouis_mo_08',
                        'recordCount': '2592155',
                        'sizeKey': '973563630'},
                       {'averageRecordSize': '343',
                        'name': 'detroit_mi_12',
                        'recordCount': '6611757',
                        'sizeKey': '2269656469'},
                       {'averageRecordSize': '371',
                        'name': 'augusta_me_08',
                        'recordCount': '197547',
                        'sizeKey': '73448274'},
                       {'averageRecordSize': '441',
                        'name': 'jackson_ms_07',
                        'recordCount': '1194231',
                        'sizeKey': '527299743'},
                       {'averageRecordSize': '373',
                        'name': 'sanantonio_tx_13',
                        'recordCount': '7632504',
                        'sizeKey': '2850279804'},
                       {'averageRecordSize': '389',
                        'name': 'concord_nh_09',
                        'recordCount': '295579',
                        'sizeKey': '115061780'},
                       {'averageRecordSize': '450',
                        'name': 'newhaven_ct_13',
                        'recordCount': '3199604',
                        'sizeKey': '1440001236'},
                       {'averageRecordSize': '445',
                        'name': 'newhaven_ct_07',
                        'recordCount': '2266588',
                        'sizeKey': '1010291733'},
                       {'averageRecordSize': '360',
                        'name': 'hartford_ct_13',
                        'recordCount': '1743212',
                        'sizeKey': '629066047'},
                       {'averageRecordSize': '461',
                        'name': 'lancaster_pa_10',
                        'recordCount': '1087422',
                        'sizeKey': '501497495'},
                       {'averageRecordSize': '427',
                        'name': 'providence_ri_04',
                        'recordCount': '1893543',
                        'sizeKey': '810405246'},
                       {'averageRecordSize': '457',
                        'name': 'stlouis_mo_13',
                        'recordCount': '6902636',
                        'sizeKey': '3156286854'},
                       {'averageRecordSize': '449',
                        'name': 'reno_nv_07',
                        'recordCount': '1865839',
                        'sizeKey': '838755340'},
                       {'averageRecordSize': '453',
                        'name': 'huntsville_al_09',
                        'recordCount': '1530028',
                        'sizeKey': '693562435'},
                       {'averageRecordSize': '422',
                        'name': 'lansing_mi_13',
                        'recordCount': '1458956',
                        'sizeKey': '616631964'},
                       {'averageRecordSize': '445',
                        'name': 'sanantonio_tx_08',
                        'recordCount': '6514066',
                        'sizeKey': '2902221230'},
                       {'averageRecordSize': '454',
                        'name': 'tampa_fl_13',
                        'recordCount': '7508366',
                        'sizeKey': '3413163824'},
                       {'averageRecordSize': '459',
                        'name': 'sanfrancisco_ca_13',
                        'recordCount': '15670272',
                        'sizeKey': '7207476296'},
                       {'averageRecordSize': '347',
                        'name': 'atlanta_ga_08',
                        'recordCount': '779442',
                        'sizeKey': '270545583'},
                       {'averageRecordSize': '382',
                        'name': 'missionviejo_ca_13',
                        'recordCount': '1506684',
                        'sizeKey': '576095729'},
                       {'averageRecordSize': '477',
                        'name': 'sarasota_fl_09',
                        'recordCount': '2170237',
                        'sizeKey': '1036376154'},
                       {'averageRecordSize': '486',
                        'name': 'scranton_pa_08',
                        'recordCount': '1106109',
                        'sizeKey': '538568751'},
                       {'averageRecordSize': '461',
                        'name': 'austin_tx_06',
                        'recordCount': '1961996',
                        'sizeKey': '904618767'},
                       {'averageRecordSize': '475',
                        'name': 'batonrouge_la_12',
                        'recordCount': '1731873',
                        'sizeKey': '824328480'},
                       {'averageRecordSize': '465',
                        'name': 'louisville_ky_12',
                        'recordCount': '2626886',
                        'sizeKey': '1222558464'},
                       {'averageRecordSize': '436',
                        'name': 'bakersfield_ca_10',
                        'recordCount': '2243047',
                        'sizeKey': '978943779'},
                       {'averageRecordSize': '427',
                        'name': 'lincoln_ne_08',
                        'recordCount': '1191076',
                        'sizeKey': '509224080'},
                       {'averageRecordSize': '394',
                        'name': 'montpelier_vt_09',
                        'recordCount': '149506',
                        'sizeKey': '58931709'},
                       {'averageRecordSize': '413',
                        'name': 'portland_or_12',
                        'recordCount': '3411524',
                        'sizeKey': '1410540603'},
                       {'averageRecordSize': '441',
                        'name': 'atlanta_ga_13',
                        'recordCount': '7430220',
                        'sizeKey': '3282976316'},
                       {'averageRecordSize': '468',
                        'name': 'charlotte_nc_12',
                        'recordCount': '3389244',
                        'sizeKey': '1586617663'},
                       {'averageRecordSize': '378',
                        'name': 'greensboro_nc_09',
                        'recordCount': '1390446',
                        'sizeKey': '526077933'},
                       {'averageRecordSize': '454',
                        'name': 'orlando_fl_09',
                        'recordCount': '1817418',
                        'sizeKey': '825642968'},
                       {'averageRecordSize': '423',
                        'name': 'wichita_ks_12',
                        'recordCount': '1376803',
                        'sizeKey': '582587205'},
                       {'averageRecordSize': '379',
                        'name': 'charleston_sc_10',
                        'recordCount': '601714',
                        'sizeKey': '228453460'},
                       {'averageRecordSize': '439',
                        'name': 'milwaukee_wi_13',
                        'recordCount': '4518559',
                        'sizeKey': '1988152027'},
                       {'averageRecordSize': '434',
                        'name': 'olympia_wa_10',
                        'recordCount': '971478',
                        'sizeKey': '421988549'},
                       {'averageRecordSize': '360',
                        'name': 'washington_dc_12',
                        'recordCount': '974435',
                        'sizeKey': '351495732'},
                       {'averageRecordSize': '468',
                        'name': 'baltimore_md_13',
                        'recordCount': '3197072',
                        'sizeKey': '1499243538'},
                       {'averageRecordSize': '434',
                        'name': 'providence_ri_12',
                        'recordCount': '2513815',
                        'sizeKey': '1091867994'},
                       {'averageRecordSize': '434',
                        'name': 'sacramento_ca_12',
                        'recordCount': '3539218',
                        'sizeKey': '1536968897'},
                       {'averageRecordSize': '413',
                        'name': 'springfield_il_09',
                        'recordCount': '826880',
                        'sizeKey': '341981523'},
                       {'averageRecordSize': '351',
                        'name': 'helena_mt_13',
                        'recordCount': '292615',
                        'sizeKey': '102735739'},
                       {'averageRecordSize': '438',
                        'name': 'columbus_oh_12',
                        'recordCount': '3192903',
                        'sizeKey': '1400174330'},
                       {'averageRecordSize': '426',
                        'name': 'modesto_ca_10',
                        'recordCount': '1055614',
                        'sizeKey': '450470718'},
                       {'averageRecordSize': '423',
                        'name': 'saltlakecity_ut_12',
                        'recordCount': '2770317',
                        'sizeKey': '1173780262'},
                       {'averageRecordSize': '459',
                        'name': 'elpaso_tx_07',
                        'recordCount': '1847943',
                        'sizeKey': '849606416'},
                       {'averageRecordSize': '408',
                        'name': 'youngstown_oh_08',
                        'recordCount': '2059421',
                        'sizeKey': '841827450'},
                       {'averageRecordSize': '467',
                        'name': 'louisville_ky_06',
                        'recordCount': '2411810',
                        'sizeKey': '1126539560'},
                       {'averageRecordSize': '438',
                        'name': 'dayton_oh_12',
                        'recordCount': '2303210',
                        'sizeKey': '1009146983'},
                       {'averageRecordSize': '423',
                        'name': 'grandrapids_mi_13',
                        'recordCount': '2318276',
                        'sizeKey': '981730490'},
                       {'averageRecordSize': '399',
                        'name': 'andrewsafb_dc_12',
                        'recordCount': '82951',
                        'sizeKey': '33134251'},
                       {'averageRecordSize': '373',
                        'name': 'corpuschristi_tx_12',
                        'recordCount': '486714',
                        'sizeKey': '181779392'},
                       {'averageRecordSize': '440',
                        'name': 'boise_id_13',
                        'recordCount': '1898243',
                        'sizeKey': '836234650'},
                       {'averageRecordSize': '466',
                        'name': 'baltimore_md_08',
                        'recordCount': '2463896',
                        'sizeKey': '1148527121'},
                       {'averageRecordSize': '450',
                        'name': 'springfield_ma_13',
                        'recordCount': '1479121',
                        'sizeKey': '666175820'},
                       {'averageRecordSize': '446',
                        'name': 'tulsa_ok_08',
                        'recordCount': '3052714',
                        'sizeKey': '1362493147'},
                       {'averageRecordSize': '461',
                        'name': 'palmbay_fl_10',
                        'recordCount': '2792324',
                        'sizeKey': '1287322795'},
                       {'averageRecordSize': '476',
                        'name': 'augusta_ga_10',
                        'recordCount': '1847520',
                        'sizeKey': '879621536'},
                       {'averageRecordSize': '426',
                        'name': 'columbus_oh_06',
                        'recordCount': '2386361',
                        'sizeKey': '1016837645'},
                       {'averageRecordSize': '366',
                        'name': 'allentown_pa_06',
                        'recordCount': '1686426',
                        'sizeKey': '617830692'},
                       {'averageRecordSize': '413',
                        'name': 'chicago_il_08',
                        'recordCount': '9538577',
                        'sizeKey': '3941184933'},
                       {'averageRecordSize': '465',
                        'name': 'austin_tx_12',
                        'recordCount': '1556662',
                        'sizeKey': '723946838'},
                       {'averageRecordSize': '421',
                        'name': 'milwaukee_wi_07',
                        'recordCount': '2453378',
                        'sizeKey': '1034158413'},
                       {'averageRecordSize': '347',
                        'name': 'cheyenne_wy_08',
                        'recordCount': '402123',
                        'sizeKey': '139678549'},
                       {'averageRecordSize': '466',
                        'name': 'philadelphia_pa_07',
                        'recordCount': '10435788',
                        'sizeKey': '4864681765'},
                       {'averageRecordSize': '454',
                        'name': 'houston_tx_10',
                        'recordCount': '7585838',
                        'sizeKey': '3447949344'},
                       {'averageRecordSize': '440',
                        'name': 'lubbock_tx_08',
                        'recordCount': '853908',
                        'sizeKey': '376189754'},
                       {'averageRecordSize': '452',
                        'name': 'bridgeport_ct_13',
                        'recordCount': '1507044',
                        'sizeKey': '681329274'},
                       {'averageRecordSize': '427',
                        'name': 'indianapolis_in_06',
                        'recordCount': '1844699',
                        'sizeKey': '789081007'},
                       {'averageRecordSize': '382',
                        'name': 'mobile_al_10',
                        'recordCount': '171834',
                        'sizeKey': '65783643'},
                       {'averageRecordSize': '379',
                        'name': 'charlotte_nc_06',
                        'recordCount': '1577401',
                        'sizeKey': '599166638'},
                       {'averageRecordSize': '456',
                        'name': 'norfolk_va_07',
                        'recordCount': '5183977',
                        'sizeKey': '2368602650'},
                       {'averageRecordSize': '443',
                        'name': 'shreveport_la_08',
                        'recordCount': '1662571',
                        'sizeKey': '737529502'},
                       {'averageRecordSize': '417',
                        'name': 'spokane_wa_08',
                        'recordCount': '1769773',
                        'sizeKey': '738089047'},
                       {'averageRecordSize': '440',
                        'name': 'indianapolis_in_12',
                        'recordCount': '4976689',
                        'sizeKey': '2192140699'},
                       {'averageRecordSize': '437',
                        'name': 'poughkeepsie_ny_12',
                        'recordCount': '1550271',
                        'sizeKey': '678013304'},
                       {'averageRecordSize': '343',
                        'name': 'fortwayne_in_08',
                        'recordCount': '726574',
                        'sizeKey': '249548529'},
                       {'averageRecordSize': '417',
                        'name': 'buffalo_ny_08',
                        'recordCount': '2984162',
                        'sizeKey': '1246914547'},
                       {'averageRecordSize': '462',
                        'name': 'omaha_ne_13',
                        'recordCount': '3290727',
                        'sizeKey': '1523074794'},
                       {'averageRecordSize': '421',
                        'name': 'toledo_oh_06',
                        'recordCount': '1793821',
                        'sizeKey': '756070358'},
                       {'averageRecordSize': '420',
                        'name': 'salem_or_08',
                        'recordCount': '1061422',
                        'sizeKey': '446560506'},
                       {'averageRecordSize': '346',
                        'name': 'anaheim_ca_10',
                        'recordCount': '448938',
                        'sizeKey': '155648636'},
                       {'averageRecordSize': '437',
                        'name': 'fresno_ca_13',
                        'recordCount': '3153318',
                        'sizeKey': '1378984881'},
                       {'averageRecordSize': '428',
                        'name': 'jeffersoncity_mo_08',
                        'recordCount': '412442',
                        'sizeKey': '176719494'},
                       {'averageRecordSize': '452',
                        'name': 'montgomery_al_07',
                        'recordCount': '1037837',
                        'sizeKey': '469249204'},
                       {'averageRecordSize': '348',
                        'name': 'santafe_nm_09',
                        'recordCount': '667464',
                        'sizeKey': '232556544'},
                       {'averageRecordSize': '445',
                        'name': 'winstonsalem_nc_09',
                        'recordCount': '1348314',
                        'sizeKey': '600830798'},
                       {'averageRecordSize': '458',
                        'name': 'madison_wi_10',
                        'recordCount': '1338782',
                        'sizeKey': '613257669'},
                       {'averageRecordSize': '434',
                        'name': 'oklahomacity_ok_07',
                        'recordCount': '1925492',
                        'sizeKey': '836056019'},
                       {'averageRecordSize': '443',
                        'name': 'sanbernardinoriverside_ca_12',
                        'recordCount': '3704305',
                        'sizeKey': '1644102378'},
                       {'averageRecordSize': '452',
                        'name': 'cincinnati_oh_10',
                        'recordCount': '2590722',
                        'sizeKey': '1172920853'},
                       {'averageRecordSize': '381',
                        'name': 'arnold_mo_06',
                        'recordCount': '313833',
                        'sizeKey': '119839027'},
                       {'averageRecordSize': '414',
                        'name': 'cleveland_oh_12',
                        'recordCount': '4581757',
                        'sizeKey': '1897355558'},
                       {'averageRecordSize': '354',
                        'name': 'helena_mt_07',
                        'recordCount': '269532',
                        'sizeKey': '95467540'},
                       {'averageRecordSize': '424',
                        'name': 'sandiego_ca_08',
                        'recordCount': '1784361',
                        'sizeKey': '757158037'},
                       {'averageRecordSize': '432',
                        'name': 'sandiego_ca_13',
                        'recordCount': '1701171',
                        'sizeKey': '735262449'},
                       {'averageRecordSize': '348',
                        'name': 'carsoncity_nv_09',
                        'recordCount': '390587',
                        'sizeKey': '135988606'},
                       {'averageRecordSize': '439',
                        'name': 'albuquerque_nm_06',
                        'recordCount': '2395739',
                        'sizeKey': '1053718612'},
                       {'averageRecordSize': '357',
                        'name': 'coloradosprings_co_06',
                        'recordCount': '1586917',
                        'sizeKey': '567403334'},
                       {'averageRecordSize': '342',
                        'name': 'littlerock_ar_08',
                        'recordCount': '1260653',
                        'sizeKey': '431407255'},
                       {'averageRecordSize': '449',
                        'name': 'amarillo_tx_08',
                        'recordCount': '856746',
                        'sizeKey': '385344801'},
                       {'averageRecordSize': '384',
                        'name': 'albany_ny_06',
                        'recordCount': '1472710',
                        'sizeKey': '566493029'},
                       {'averageRecordSize': '450',
                        'name': 'columbus_ga_09',
                        'recordCount': '903410',
                        'sizeKey': '406742163'},
                       {'averageRecordSize': '444',
                        'name': 'oxnard_ca_10',
                        'recordCount': '1368678',
                        'sizeKey': '608839674'},
                       {'averageRecordSize': '426',
                        'name': 'topeka_ks_08',
                        'recordCount': '853869',
                        'sizeKey': '364071006'},
                       {'averageRecordSize': '468',
                        'name': 'newyork_ny_05',
                        'recordCount': '4327294',
                        'sizeKey': '2026175993'},
                       {'averageRecordSize': '384',
                        'name': 'charleston_wv_09',
                        'recordCount': '681490',
                        'sizeKey': '262319888'},
                       {'averageRecordSize': '454',
                        'name': 'raleighdurham_nc_10',
                        'recordCount': '2446905',
                        'sizeKey': '1111800379'},
                       {'averageRecordSize': '376',
                        'name': 'bridgeport_ct_06',
                        'recordCount': '1368703',
                        'sizeKey': '514999166'},
                       {'averageRecordSize': '427',
                        'name': 'denver_co_12',
                        'recordCount': '10194942',
                        'sizeKey': '4356651699'},
                       {'averageRecordSize': '461',
                        'name': 'miami_fl_09',
                        'recordCount': '7578379',
                        'sizeKey': '3496706531'},
                       {'averageRecordSize': '361',
                        'name': 'bismarck_nd_08',
                        'recordCount': '407942',
                        'sizeKey': '147540441'},
                       {'averageRecordSize': '426',
                        'name': 'rochester_ny_08',
                        'recordCount': '1626996',
                        'sizeKey': '694407592'},
                       {'averageRecordSize': '427',
                        'name': 'minneapolis_mn_07',
                        'recordCount': '7065121',
                        'sizeKey': '3019222186'},
                       {'averageRecordSize': '453',
                        'name': 'worcester_ma_09',
                        'recordCount': '920227',
                        'sizeKey': '417697945'},
                       {'averageRecordSize': '398',
                        'name': 'dover_de_09',
                        'recordCount': '382320',
                        'sizeKey': '152220064'},
                       {'averageRecordSize': '447',
                        'name': 'lasvegas_nv_09',
                        'recordCount': '6555811',
                        'sizeKey': '2935105206'},
                       {'averageRecordSize': '473',
                        'name': 'mcallen_tx_08',
                        'recordCount': '1213345',
                        'sizeKey': '575055834'},
                       {'averageRecordSize': '418',
                        'name': 'toledo_oh_12',
                        'recordCount': '1804579',
                        'sizeKey': '754892393'},
                       {'averageRecordSize': '494',
                        'name': 'lexington_ky_12',
                        'recordCount': '1336955',
                        'sizeKey': '661694430'},
                       {'averageRecordSize': '378',
                        'name': 'pierre_sd_08',
                        'recordCount': '86089',
                        'sizeKey': '32556962'},
                       {'averageRecordSize': '450',
                        'name': 'columbia_sc_09',
                        'recordCount': '991882',
                        'sizeKey': '446630818'},
                       {'averageRecordSize': '417',
                        'name': 'lansing_mi_07',
                        'recordCount': '1453031',
                        'sizeKey': '606049639'},
                       {'averageRecordSize': '455',
                        'name': 'springfield_ma_07',
                        'recordCount': '1404959',
                        'sizeKey': '640465801'},
                       {'averageRecordSize': '418',
                        'name': 'flint_mi_09',
                        'recordCount': '1691484',
                        'sizeKey': '708522142'},
                       {'averageRecordSize': '390',
                        'name': 'ftbelvoir_dc_12',
                        'recordCount': '465619',
                        'sizeKey': '181639357'},
                       {'averageRecordSize': '441',
                        'name': 'boise_id_07',
                        'recordCount': '1697304',
                        'sizeKey': '749642886'},
                       {'averageRecordSize': '449',
                        'name': 'albuquerque_nm_12',
                        'recordCount': '2498935',
                        'sizeKey': '1122804513'},
                       {'averageRecordSize': '457',
                        'name': 'trenton_nj_08',
                        'recordCount': '774595',
                        'sizeKey': '354553632'},
                       {'averageRecordSize': '433',
                        'name': 'boulder_co_14',
                        'recordCount': '3822227',
                        'sizeKey': '1657373106'},
                       {'averageRecordSize': '419',
                        'name': 'chicago_il_12',
                        'recordCount': '11573445',
                        'sizeKey': '4857437673'},
                       {'averageRecordSize': '436',
                        'name': 'fresno_ca_06',
                        'recordCount': '2805365',
                        'sizeKey': '1224903291'},
                       {'averageRecordSize': '403',
                        'name': 'seattle_wa_11',
                        'recordCount': '1608715',
                        'sizeKey': '649308716'},
                       {'averageRecordSize': '438',
                        'name': 'laguardiajfk_ny_07',
                        'recordCount': '4159364',
                        'sizeKey': '1821897574'},
                       {'averageRecordSize': '426',
                        'name': 'rochester_ny_14',
                        'recordCount': '1513957',
                        'sizeKey': '646178617'}]


      try:
          logger.info(f"Recreating table: {self.pv_rooftops_aspects_table_name}")
          response = self.glue.delete_table(
              DatabaseName=self.database_name,
              Name=self.pv_rooftops_aspects_table_name
          )
      except ClientError as e:
          if e.response['Error']['Code'] == 'EntityNotFoundException':
              logger.debug(r"Skipping table deletion as it does not exist: {self.pv_rooftops_aspects_table_name}")

      logger.info("Creating pv_rooftops aspects table")

      response = self.glue.create_table(
          DatabaseName=self.database_name,
          TableInput={
              'Name': self.pv_rooftops_aspects_table_name,
              'PartitionKeys': [{'Name': 'city_year', 'Type': 'string'}],
              'Retention': 0,
              'Parameters': {'averageRecordSize': '433',
                            'classification': 'parquet',
                            'compressionType': 'none',
                            'objectCount': '28',
                            'recordCount': '52478652',
                            'sizeKey': '22987242882',
                            'typeOfData': 'file'},
              'StorageDescriptor': {'BucketColumns': [],
                               'Columns': [{'Name': 'gid', 'Type': 'bigint'},
                                           {'Name': 'city', 'Type': 'string'},
                                           {'Name': 'state',
                                            'Type': 'string'},
                                           {'Name': 'year', 'Type': 'bigint'},
                                           {'Name': 'bldg_fid',
                                            'Type': 'bigint'},
                                           {'Name': 'aspect',
                                            'Type': 'bigint'},
                                           {'Name': 'the_geom_96703',
                                            'Type': 'string'},
                                           {'Name': 'the_geom_4326',
                                            'Type': 'string'},
                                           {'Name': 'region_id',
                                            'Type': 'bigint'},
                                           {'Name': '__index_level_0__',
                                            'Type': 'bigint'}],
                               'Compressed': False,
                               'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                               'Location': f'{self.pv_rooftops_bucket}/aspects/',
                               'NumberOfBuckets': -1,
                               'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                               'Parameters': {'averageRecordSize': '433',
                                              'classification': 'parquet',
                                              'compressionType': 'none',
                                              'objectCount': '28',
                                              'recordCount': '52478652',
                                              'sizeKey': '22987242882',
                                              'typeOfData': 'file'},
                               'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                             'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                               'SortColumns': [],
                               'StoredAsSubDirectories': False},
         'TableType': 'EXTERNAL_TABLE'
          }
      )

      #pprint(response)

      logger.info("Creating pv_rooftops aspects partitions")

      count = 0
      templateArray = []
      for partition in partitionsArray:
          #pprint(partition)
          count = count + 1
          thisTemplate = self.get_pv_rooftop_aspects_partition_template()
          thisTemplate['StorageDescriptor']['Location'] = f"{self.pv_rooftops_bucket}/aspects/{partition['name']}/"
          thisTemplate['StorageDescriptor']['Parameters']['averageRecordSize'] = partition['averageRecordSize']
          thisTemplate['StorageDescriptor']['Parameters']['recordCount'] = partition['recordCount']
          thisTemplate['StorageDescriptor']['Parameters']['sizeKey'] = partition['sizeKey']
          thisTemplate['Values'][0] = partition['name']
          templateArray.append(thisTemplate)

          #pprint(templateArray)
          #print(count)
          if count%10 == 0:
              #print('submitting')
              logger.info("Submitting pv_rooftop aspects partitions batch")
              #pprint(templateArray)
              response2 = self.glue.batch_create_partition(
                  DatabaseName = self.database_name,
                  TableName = self.pv_rooftops_aspects_table_name,
                  PartitionInputList = templateArray
              )
              #pprint(response2)
              templateArray = []

      if count%10 != 0:
          logger.info("Submitting pv_rooftop aspects partitions batch")
          response2 = self.glue.batch_create_partition(
              DatabaseName=self.database_name,
              TableName=self.pv_rooftops_aspects_table_name,
              PartitionInputList=templateArray
          )
          #pprint(response2)


    def create_pv_rooftop_developable_planes_table(self):

      partitionsArray = [{'averageRecordSize': '561',
                        'name': 'sandiego_ca_13',
                        'recordCount': '1086288',
                        'sizeKey': '609744415'},
                       {'averageRecordSize': '608',
                        'name': 'flint_mi_09',
                        'recordCount': '1013798',
                        'sizeKey': '616889964'},
                       {'averageRecordSize': '528',
                        'name': 'littlerock_ar_08',
                        'recordCount': '654317',
                        'sizeKey': '345992427'},
                       {'averageRecordSize': '563',
                        'name': 'tallahassee_fl_09',
                        'recordCount': '440573',
                        'sizeKey': '248067580'},
                       {'averageRecordSize': '593',
                        'name': 'dover_de_09',
                        'recordCount': '219162',
                        'sizeKey': '130018230'},
                       {'averageRecordSize': '608',
                        'name': 'philadelphia_pa_07',
                        'recordCount': '5258095',
                        'sizeKey': '3200337948'},
                       {'averageRecordSize': '445',
                        'name': 'sacramento_ca_12',
                        'recordCount': '2346013',
                        'sizeKey': '1044690204'},
                       {'averageRecordSize': '565',
                        'name': 'tampa_fl_13',
                        'recordCount': '4705336',
                        'sizeKey': '2661911443'},
                       {'averageRecordSize': '566',
                        'name': 'providence_ri_04',
                        'recordCount': '1036504',
                        'sizeKey': '587097556'},
                       {'averageRecordSize': '512',
                        'name': 'salem_or_08',
                        'recordCount': '660095',
                        'sizeKey': '338261320'},
                       {'averageRecordSize': '535',
                        'name': 'sanbernardinoriverside_ca_12',
                        'recordCount': '2387671',
                        'sizeKey': '1279580707'},
                       {'averageRecordSize': '588',
                        'name': 'charlotte_nc_06',
                        'recordCount': '803271',
                        'sizeKey': '473006967'},
                       {'averageRecordSize': '499',
                        'name': 'lincoln_ne_08',
                        'recordCount': '730607',
                        'sizeKey': '365185507'},
                       {'averageRecordSize': '602',
                        'name': 'augusta_ga_10',
                        'recordCount': '969440',
                        'sizeKey': '583917638'},
                       {'averageRecordSize': '596',
                        'name': 'oklahomacity_ok_13',
                        'recordCount': '2392117',
                        'sizeKey': '1427625383'},
                       {'averageRecordSize': '553',
                        'name': 'newhaven_ct_07',
                        'recordCount': '1202180',
                        'sizeKey': '664854615'},
                       {'averageRecordSize': '574',
                        'name': 'stlouis_mo_13',
                        'recordCount': '3788131',
                        'sizeKey': '2177625744'},
                       {'averageRecordSize': '450',
                        'name': 'boise_id_13',
                        'recordCount': '1209664',
                        'sizeKey': '544572022'},
                       {'averageRecordSize': '578',
                        'name': 'buffalo_ny_08',
                        'recordCount': '1778938',
                        'sizeKey': '1028490208'},
                       {'averageRecordSize': '453',
                        'name': 'helena_mt_13',
                        'recordCount': '201104',
                        'sizeKey': '91242294'},
                       {'averageRecordSize': '607',
                        'name': 'lancaster_pa_10',
                        'recordCount': '598978',
                        'sizeKey': '363967512'},
                       {'averageRecordSize': '559',
                        'name': 'omaha_ne_07',
                        'recordCount': '971635',
                        'sizeKey': '543802382'},
                       {'averageRecordSize': '602',
                        'name': 'anaheim_ca_10',
                        'recordCount': '299612',
                        'sizeKey': '180403020'},
                       {'averageRecordSize': '451',
                        'name': 'cheyenne_wy_08',
                        'recordCount': '284434',
                        'sizeKey': '128533904'},
                       {'averageRecordSize': '567',
                        'name': 'rochester_ny_14',
                        'recordCount': '839112',
                        'sizeKey': '475866238'},
                       {'averageRecordSize': '655',
                        'name': 'columbus_oh_12',
                        'recordCount': '1794207',
                        'sizeKey': '1176507141'},
                       {'averageRecordSize': '577',
                        'name': 'hartford_ct_13',
                        'recordCount': '921330',
                        'sizeKey': '531730546'},
                       {'averageRecordSize': '522',
                        'name': 'minneapolis_mn_12',
                        'recordCount': '5770086',
                        'sizeKey': '3012054033'},
                       {'averageRecordSize': '559',
                        'name': 'montpelier_vt_09',
                        'recordCount': '86622',
                        'sizeKey': '48469214'},
                       {'averageRecordSize': '631',
                        'name': 'santafe_nm_09',
                        'recordCount': '322306',
                        'sizeKey': '203690077'},
                       {'averageRecordSize': '571',
                        'name': 'concord_nh_09',
                        'recordCount': '150500',
                        'sizeKey': '86064390'},
                       {'averageRecordSize': '579',
                        'name': 'fortwayne_in_08',
                        'recordCount': '435634',
                        'sizeKey': '252670875'},
                       {'averageRecordSize': '568',
                        'name': 'allentown_pa_06',
                        'recordCount': '935725',
                        'sizeKey': '531838537'},
                       {'averageRecordSize': '554',
                        'name': 'bridgeport_ct_06',
                        'recordCount': '706323',
                        'sizeKey': '391654665'},
                       {'averageRecordSize': '572',
                        'name': 'charleston_sc_10',
                        'recordCount': '318805',
                        'sizeKey': '182646534'},
                       {'averageRecordSize': '540',
                        'name': 'tampa_fl_08',
                        'recordCount': '767038',
                        'sizeKey': '414710735'},
                       {'averageRecordSize': '567',
                        'name': 'milwaukee_wi_07',
                        'recordCount': '1387180',
                        'sizeKey': '786614902'},
                       {'averageRecordSize': '554',
                        'name': 'arnold_mo_06',
                        'recordCount': '181985',
                        'sizeKey': '100886222'},
                       {'averageRecordSize': '595',
                        'name': 'sanantonio_tx_08',
                        'recordCount': '4016800',
                        'sizeKey': '2391926172'},
                       {'averageRecordSize': '577',
                        'name': 'seattle_wa_11',
                        'recordCount': '982130',
                        'sizeKey': '567493576'},
                       {'averageRecordSize': '639',
                        'name': 'jacksonville_fl_10',
                        'recordCount': '1034686',
                        'sizeKey': '662074670'},
                       {'averageRecordSize': '574',
                        'name': 'youngstown_oh_08',
                        'recordCount': '1167757',
                        'sizeKey': '670486538'},
                       {'averageRecordSize': '577',
                        'name': 'austin_tx_06',
                        'recordCount': '1112879',
                        'sizeKey': '642419631'},
                       {'averageRecordSize': '574',
                        'name': 'charlotte_nc_12',
                        'recordCount': '1700903',
                        'sizeKey': '977971251'},
                       {'averageRecordSize': '432',
                        'name': 'helena_mt_07',
                        'recordCount': '181803',
                        'sizeKey': '78700254'},
                       {'averageRecordSize': '452',
                        'name': 'saltlakecity_ut_12',
                        'recordCount': '1906029',
                        'sizeKey': '863316403'},
                       {'averageRecordSize': '613',
                        'name': 'lexington_ky_12',
                        'recordCount': '758798',
                        'sizeKey': '465183685'},
                       {'averageRecordSize': '439',
                        'name': 'lasvegas_nv_09',
                        'recordCount': '4056878',
                        'sizeKey': '1784217615'},
                       {'averageRecordSize': '437',
                        'name': 'spokane_wa_08',
                        'recordCount': '1106465',
                        'sizeKey': '483925352'},
                       {'averageRecordSize': '556',
                        'name': 'trenton_nj_08',
                        'recordCount': '415977',
                        'sizeKey': '231296008'},
                       {'averageRecordSize': '603',
                        'name': 'stlouis_mo_08',
                        'recordCount': '1453100',
                        'sizeKey': '877064164'},
                       {'averageRecordSize': '589',
                        'name': 'albany_ny_06',
                        'recordCount': '790772',
                        'sizeKey': '465949776'},
                       {'averageRecordSize': '433',
                        'name': 'carsoncity_nv_09',
                        'recordCount': '245883',
                        'sizeKey': '106726406'},
                       {'averageRecordSize': '580',
                        'name': 'oxnard_ca_10',
                        'recordCount': '939381',
                        'sizeKey': '545339848'},
                       {'averageRecordSize': '673',
                        'name': 'neworleans_la_12',
                        'recordCount': '2247394',
                        'sizeKey': '1513221081'},
                       {'averageRecordSize': '561',
                        'name': 'portland_or_12',
                        'recordCount': '2045745',
                        'sizeKey': '1149474264'},
                       {'averageRecordSize': '599',
                        'name': 'tulsa_ok_08',
                        'recordCount': '1874676',
                        'sizeKey': '1123524122'},
                       {'averageRecordSize': '508',
                        'name': 'boulder_co_14',
                        'recordCount': '1585315',
                        'sizeKey': '806650955'},
                       {'averageRecordSize': '549',
                        'name': 'indianapolis_in_12',
                        'recordCount': '2847405',
                        'sizeKey': '1565493138'},
                       {'averageRecordSize': '553',
                        'name': 'winstonsalem_nc_09',
                        'recordCount': '697166',
                        'sizeKey': '385976203'},
                       {'averageRecordSize': '622',
                        'name': 'frankfort_ky_12',
                        'recordCount': '155582',
                        'sizeKey': '96826799'},
                       {'averageRecordSize': '463',
                        'name': 'bakersfield_ca_10',
                        'recordCount': '1710658',
                        'sizeKey': '793121969'},
                       {'averageRecordSize': '655',
                        'name': 'palmbay_fl_10',
                        'recordCount': '1756820',
                        'sizeKey': '1151219785'},
                       {'averageRecordSize': '606',
                        'name': 'chicago_il_08',
                        'recordCount': '5428048',
                        'sizeKey': '3289873124'},
                       {'averageRecordSize': '606',
                        'name': 'madison_wi_10',
                        'recordCount': '763038',
                        'sizeKey': '462752040'},
                       {'averageRecordSize': '587',
                        'name': 'milwaukee_wi_13',
                        'recordCount': '2668082',
                        'sizeKey': '1566200188'},
                       {'averageRecordSize': '601',
                        'name': 'syracuse_ny_08',
                        'recordCount': '543559',
                        'sizeKey': '326825606'},
                       {'averageRecordSize': '644',
                        'name': 'batonrouge_la_06',
                        'recordCount': '901863',
                        'sizeKey': '581023767'},
                       {'averageRecordSize': '634',
                        'name': 'houston_tx_10',
                        'recordCount': '4467903',
                        'sizeKey': '2835293339'},
                       {'averageRecordSize': '457',
                        'name': 'reno_nv_07',
                        'recordCount': '1158847',
                        'sizeKey': '530579938'},
                       {'averageRecordSize': '641',
                        'name': 'corpuschristi_tx_12',
                        'recordCount': '288026',
                        'sizeKey': '184710471'},
                       {'averageRecordSize': '552',
                        'name': 'topeka_ks_08',
                        'recordCount': '537304',
                        'sizeKey': '297033240'},
                       {'averageRecordSize': '522',
                        'name': 'tucson_az_07',
                        'recordCount': '1213201',
                        'sizeKey': '633327844'},
                       {'averageRecordSize': '635',
                        'name': 'ftbelvoir_dc_12',
                        'recordCount': '234352',
                        'sizeKey': '148864731'},
                       {'averageRecordSize': '606',
                        'name': 'laguardiajfk_ny_07',
                        'recordCount': '2137123',
                        'sizeKey': '1296775465'},
                       {'averageRecordSize': '635',
                        'name': 'manhattan_ny_07',
                        'recordCount': '806945',
                        'sizeKey': '512915785'},
                       {'averageRecordSize': '689',
                        'name': 'newyork_ny_05',
                        'recordCount': '1986908',
                        'sizeKey': '1369746201'},
                       {'averageRecordSize': '542',
                        'name': 'springfield_il_09',
                        'recordCount': '500797',
                        'sizeKey': '271525581'},
                       {'averageRecordSize': '563',
                        'name': 'newhaven_ct_13',
                        'recordCount': '1644981',
                        'sizeKey': '927289791'},
                       {'averageRecordSize': '556',
                        'name': 'desmoines_ia_10',
                        'recordCount': '965282',
                        'sizeKey': '536742367'},
                       {'averageRecordSize': '20',
                        'name': 'richmond_va_08',
                        'recordCount': '336438',
                        'sizeKey': '7011016'},
                       {'averageRecordSize': '577',
                        'name': 'worcester_ma_09',
                        'recordCount': '485519',
                        'sizeKey': '280352509'},
                       {'averageRecordSize': '570',
                        'name': 'austin_tx_12',
                        'recordCount': '873871',
                        'sizeKey': '498573938'},
                       {'averageRecordSize': '573',
                        'name': 'pittsburgh_pa_04',
                        'recordCount': '1321545',
                        'sizeKey': '757448413'},
                       {'averageRecordSize': '611',
                        'name': 'batonrouge_la_12',
                        'recordCount': '981555',
                        'sizeKey': '600335797'},
                       {'averageRecordSize': '593',
                        'name': 'greensboro_nc_09',
                        'recordCount': '711741',
                        'sizeKey': '422474845'},
                       {'averageRecordSize': '440',
                        'name': 'fresno_ca_13',
                        'recordCount': '2340669',
                        'sizeKey': '1030430302'},
                       {'averageRecordSize': '653',
                        'name': 'mcallen_tx_08',
                        'recordCount': '789764',
                        'sizeKey': '516238565'},
                       {'averageRecordSize': '544',
                        'name': 'minneapolis_mn_07',
                        'recordCount': '3988305',
                        'sizeKey': '2171277336'},
                       {'averageRecordSize': '607',
                        'name': 'olympia_wa_10',
                        'recordCount': '584187',
                        'sizeKey': '355138990'},
                       {'averageRecordSize': '487',
                        'name': 'coloradosprings_co_13',
                        'recordCount': '1494644',
                        'sizeKey': '728116493'},
                       {'averageRecordSize': '533',
                        'name': 'elpaso_tx_07',
                        'recordCount': '1261178',
                        'sizeKey': '672655032'},
                       {'averageRecordSize': '617',
                        'name': 'harrisburg_pa_09',
                        'recordCount': '1344537',
                        'sizeKey': '829702819'},
                       {'averageRecordSize': '544',
                        'name': 'augusta_me_08',
                        'recordCount': '112882',
                        'sizeKey': '61433527'},
                       {'averageRecordSize': '641',
                        'name': 'baltimore_md_08',
                        'recordCount': '1344614',
                        'sizeKey': '863001123'},
                       {'averageRecordSize': '610',
                        'name': 'orlando_fl_09',
                        'recordCount': '1069978',
                        'sizeKey': '653318109'},
                       {'averageRecordSize': '587',
                        'name': 'louisville_ky_06',
                        'recordCount': '1321752',
                        'sizeKey': '777190309'},
                       {'averageRecordSize': '573',
                        'name': 'oklahomacity_ok_07',
                        'recordCount': '1236017',
                        'sizeKey': '708981177'},
                       {'averageRecordSize': '549',
                        'name': 'providence_ri_12',
                        'recordCount': '1369581',
                        'sizeKey': '752837924'},
                       {'averageRecordSize': '477',
                        'name': 'stockton_ca_10',
                        'recordCount': '1151531',
                        'sizeKey': '550028222'},
                       {'averageRecordSize': '623',
                        'name': 'montgomery_al_07',
                        'recordCount': '594953',
                        'sizeKey': '371044548'},
                       {'averageRecordSize': '553',
                        'name': 'shreveport_la_08',
                        'recordCount': '909115',
                        'sizeKey': '503240586'},
                       {'averageRecordSize': '559',
                        'name': 'kansascity_mo_10',
                        'recordCount': '1387194',
                        'sizeKey': '775516411'},
                       {'averageRecordSize': '579',
                        'name': 'charleston_wv_09',
                        'recordCount': '374058',
                        'sizeKey': '216803446'},
                       {'averageRecordSize': '630',
                        'name': 'newyork_ny_13',
                        'recordCount': '8083961',
                        'sizeKey': '5100666739'},
                       {'averageRecordSize': '549',
                        'name': 'sandiego_ca_08',
                        'recordCount': '1151590',
                        'sizeKey': '632901153'},
                       {'averageRecordSize': '510',
                        'name': 'springfield_ma_07',
                        'recordCount': '619440',
                        'sizeKey': '316244330'},
                       {'averageRecordSize': '466',
                        'name': 'springfield_ma_13',
                        'recordCount': '667190',
                        'sizeKey': '310958861'},
                       {'averageRecordSize': '577',
                        'name': 'columbia_sc_09',
                        'recordCount': '511105',
                        'sizeKey': '295084564'},
                       {'averageRecordSize': '539',
                        'name': 'grandrapids_mi_13',
                        'recordCount': '2010459',
                        'sizeKey': '1084205959'},
                       {'averageRecordSize': '548',
                        'name': 'cleveland_oh_12',
                        'recordCount': '2524288',
                        'sizeKey': '1384059164'},
                       {'averageRecordSize': '593',
                        'name': 'cincinnati_oh_10',
                        'recordCount': '1403033',
                        'sizeKey': '832835167'},
                       {'averageRecordSize': '610',
                        'name': 'omaha_ne_13',
                        'recordCount': '1926334',
                        'sizeKey': '1175305054'},
                       {'averageRecordSize': '577',
                        'name': 'poughkeepsie_ny_12',
                        'recordCount': '833490',
                        'sizeKey': '481466882'},
                       {'averageRecordSize': '489',
                        'name': 'albuquerque_nm_12',
                        'recordCount': '1530885',
                        'sizeKey': '750096085'},
                       {'averageRecordSize': '594',
                        'name': 'atlanta_ga_08',
                        'recordCount': '359175',
                        'sizeKey': '213651892'},
                       {'averageRecordSize': '433',
                        'name': 'newark_nj_07',
                        'recordCount': '2210742',
                        'sizeKey': '957296031'},
                       {'averageRecordSize': '558',
                        'name': 'missionviejo_ca_13',
                        'recordCount': '869237',
                        'sizeKey': '485419811'},
                       {'averageRecordSize': '605',
                        'name': 'baltimore_md_13',
                        'recordCount': '1695834',
                        'sizeKey': '1027609896'},
                       {'averageRecordSize': '572',
                        'name': 'jackson_ms_07',
                        'recordCount': '607237',
                        'sizeKey': '347675767'},
                       {'averageRecordSize': '576',
                        'name': 'albany_ny_13',
                        'recordCount': '1172415',
                        'sizeKey': '675551706'},
                       {'averageRecordSize': '543',
                        'name': 'kansascity_mo_12',
                        'recordCount': '1981041',
                        'sizeKey': '1076061331'},
                       {'averageRecordSize': '651',
                        'name': 'mobile_al_10',
                        'recordCount': '94202',
                        'sizeKey': '61345398'},
                       {'averageRecordSize': '476',
                        'name': 'bismarck_nd_08',
                        'recordCount': '282126',
                        'sizeKey': '134455653'},
                       {'averageRecordSize': '620',
                        'name': 'pensacola_fl_09',
                        'recordCount': '741548',
                        'sizeKey': '459826187'},
                       {'averageRecordSize': '486',
                        'name': 'amarillo_tx_08',
                        'recordCount': '607242',
                        'sizeKey': '295686192'},
                       {'averageRecordSize': '550',
                        'name': 'rochester_ny_08',
                        'recordCount': '897812',
                        'sizeKey': '494163395'},
                       {'averageRecordSize': '480',
                        'name': 'coloradosprings_co_06',
                        'recordCount': '997380',
                        'sizeKey': '479608986'},
                       {'averageRecordSize': '579',
                        'name': 'raleighdurham_nc_10',
                        'recordCount': '1169504',
                        'sizeKey': '678125073'},
                       {'averageRecordSize': '589',
                        'name': 'lansing_mi_07',
                        'recordCount': '850582',
                        'sizeKey': '501704167'},
                       {'averageRecordSize': '442',
                        'name': 'boise_id_07',
                        'recordCount': '1115705',
                        'sizeKey': '494040663'},
                       {'averageRecordSize': '544',
                        'name': 'norfolk_va_07',
                        'recordCount': '2757934',
                        'sizeKey': '1503067975'},
                       {'averageRecordSize': '550',
                        'name': 'toledo_oh_06',
                        'recordCount': '979456',
                        'sizeKey': '539039290'},
                       {'averageRecordSize': '485',
                        'name': 'toledo_oh_12',
                        'recordCount': '1041669',
                        'sizeKey': '505355054'},
                       {'averageRecordSize': '520',
                        'name': 'wichita_ks_12',
                        'recordCount': '848311',
                        'sizeKey': '441405448'},
                       {'averageRecordSize': '478',
                        'name': 'denver_co_12',
                        'recordCount': '6547096',
                        'sizeKey': '3130218248'},
                       {'averageRecordSize': '575',
                        'name': 'indianapolis_in_06',
                        'recordCount': '1044270',
                        'sizeKey': '601228763'},
                       {'averageRecordSize': '699',
                        'name': 'neworleans_la_08',
                        'recordCount': '1408692',
                        'sizeKey': '985015139'},
                       {'averageRecordSize': '546',
                        'name': 'atlanta_ga_13',
                        'recordCount': '3383601',
                        'sizeKey': '1847856401'},
                       {'averageRecordSize': '634',
                        'name': 'huntsville_al_09',
                        'recordCount': '896047',
                        'sizeKey': '568190348'},
                       {'averageRecordSize': '596',
                        'name': 'jeffersoncity_mo_08',
                        'recordCount': '235003',
                        'sizeKey': '140093612'},
                       {'averageRecordSize': '586',
                        'name': 'louisville_ky_12',
                        'recordCount': '1443862',
                        'sizeKey': '846857454'},
                       {'averageRecordSize': '685',
                        'name': 'sarasota_fl_09',
                        'recordCount': '1425451',
                        'sizeKey': '977214764'},
                       {'averageRecordSize': '581',
                        'name': 'detroit_mi_12',
                        'recordCount': '3762603',
                        'sizeKey': '2186867722'},
                       {'averageRecordSize': '453',
                        'name': 'fresno_ca_06',
                        'recordCount': '2175296',
                        'sizeKey': '985981566'},
                       {'averageRecordSize': '629',
                        'name': 'washington_dc_12',
                        'recordCount': '502357',
                        'sizeKey': '316479636'},
                       {'averageRecordSize': '495',
                        'name': 'lubbock_tx_08',
                        'recordCount': '582474',
                        'sizeKey': '288714075'},
                       {'averageRecordSize': '571',
                        'name': 'chicago_il_12',
                        'recordCount': '6619651',
                        'sizeKey': '3782343145'},
                       {'averageRecordSize': '433',
                        'name': 'modesto_ca_10',
                        'recordCount': '835253',
                        'sizeKey': '362314087'},
                       {'averageRecordSize': '601',
                        'name': 'scranton_pa_08',
                        'recordCount': '605864',
                        'sizeKey': '364248133'},
                       {'averageRecordSize': '596',
                        'name': 'sanantonio_tx_13',
                        'recordCount': '4653379',
                        'sizeKey': '2773987518'},
                       {'averageRecordSize': '608',
                        'name': 'columbus_oh_06',
                        'recordCount': '1350225',
                        'sizeKey': '821751452'},
                       {'averageRecordSize': '596',
                        'name': 'lansing_mi_13',
                        'recordCount': '824208',
                        'sizeKey': '491319168'},
                       {'averageRecordSize': '569',
                        'name': 'dayton_oh_06',
                        'recordCount': '917125',
                        'sizeKey': '522542620'},
                       {'averageRecordSize': '609',
                        'name': 'birmingham_al_08',
                        'recordCount': '536670',
                        'sizeKey': '327160254'},
                       {'averageRecordSize': '552',
                        'name': 'bridgeport_ct_13',
                        'recordCount': '767830',
                        'sizeKey': '424044744'},
                       {'averageRecordSize': '596',
                        'name': 'columbus_ga_09',
                        'recordCount': '508750',
                        'sizeKey': '303313497'},
                       {'averageRecordSize': '577',
                        'name': 'dayton_oh_12',
                        'recordCount': '1323814',
                        'sizeKey': '765080742'},
                       {'averageRecordSize': '583',
                        'name': 'hartford_ct_06',
                        'recordCount': '792799',
                        'sizeKey': '462232980'},
                       {'averageRecordSize': '509',
                        'name': 'pierre_sd_08',
                        'recordCount': '60732',
                        'sizeKey': '30973399'},
                       {'averageRecordSize': '570',
                        'name': 'richmond_va_13',
                        'recordCount': '313204',
                        'sizeKey': '178567594'},
                       {'averageRecordSize': '597',
                        'name': 'sanfrancisco_ca_13',
                        'recordCount': '9310838',
                        'sizeKey': '5565560819'},
                       {'averageRecordSize': '624',
                        'name': 'andrewsafb_dc_12',
                        'recordCount': '44357',
                        'sizeKey': '27691104'},
                       {'averageRecordSize': '487',
                        'name': 'albuquerque_nm_06',
                        'recordCount': '1470072',
                        'sizeKey': '716672576'},
                       {'averageRecordSize': '654',
                        'name': 'miami_fl_09',
                        'recordCount': '4825454',
                        'sizeKey': '3159545414'},
                       {'averageRecordSize': '572',
                        'name': 'pittsburgh_pa_12',
                        'recordCount': '2486480',
                        'sizeKey': '1422777541'}]


      try:
          logger.info(f"Recreating table: {self.pv_rooftops_dev_planes_table_name}")
          response = self.glue.delete_table(
              DatabaseName=self.database_name,
              Name=self.pv_rooftops_dev_planes_table_name
          )
      except ClientError as e:
          if e.response['Error']['Code'] == 'EntityNotFoundException':
              logger.debug(r"Skipping table deletion as it does not exist: {self.pv_rooftops_dev_planes_table_name}")

      logger.info("Creating pv_rooftops developable planes table")

      response = self.glue.create_table(
          DatabaseName=self.database_name,
          TableInput={
              'Name': self.pv_rooftops_dev_planes_table_name,
              'PartitionKeys': [{'Name': 'city_year', 'Type': 'string'}],
              'Retention': 0,
              'Parameters': {'averageRecordSize': '536',
                            'classification': 'parquet',
                            'compressionType': 'none',
                            'objectCount': '166',
                            'recordCount': '244272089',
                            'sizeKey': '138217212067',
                            'typeOfData': 'file'},
              'StorageDescriptor': {'BucketColumns': [],
                               'Columns': [{'Name': 'bldg_fid',
                                            'Type': 'bigint'},
                                           {'Name': 'footprint_m2',
                                            'Type': 'double'},
                                           {'Name': 'slope',
                                            'Type': 'bigint'},
                                           {'Name': 'flatarea_m2',
                                            'Type': 'double'},
                                           {'Name': 'slopeconversion',
                                            'Type': 'double'},
                                           {'Name': 'slopearea_m2',
                                            'Type': 'double'},
                                           {'Name': 'zip', 'Type': 'string'},
                                           {'Name': 'zip_perc',
                                            'Type': 'double'},
                                           {'Name': 'aspect',
                                            'Type': 'bigint'},
                                           {'Name': 'gid', 'Type': 'bigint'},
                                           {'Name': 'city', 'Type': 'string'},
                                           {'Name': 'state',
                                            'Type': 'string'},
                                           {'Name': 'year', 'Type': 'bigint'},
                                           {'Name': 'region_id',
                                            'Type': 'bigint'},
                                           {'Name': 'the_geom_96703',
                                            'Type': 'string'},
                                           {'Name': 'the_geom_4326',
                                            'Type': 'string'},
                                           {'Name': '__index_level_0__',
                                            'Type': 'bigint'}],
                               'Compressed': False,
                               'InputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat',
                               'Location': f'{self.pv_rooftops_bucket}/developable_planes/',
                               'NumberOfBuckets': -1,
                               'OutputFormat': 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat',
                               'Parameters': {'averageRecordSize': '536',
                                              'classification': 'parquet',
                                              'compressionType': 'none',
                                              'objectCount': '166',
                                              'recordCount': '244272089',
                                              'sizeKey': '138217212067',
                                              'typeOfData': 'file'},
                               'SerdeInfo': {'Parameters': {'serialization.format': '1'},
                                             'SerializationLibrary': 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'},
                               'SortColumns': [],
                               'StoredAsSubDirectories': False},
         'TableType': 'EXTERNAL_TABLE'
          }
      )

      #pprint(response)

      logger.info("Creating pv_rooftops developable_planes partitions")

      count = 0
      templateArray = []
      for partition in partitionsArray:
          #pprint(partition)
          count = count + 1
          thisTemplate = self.get_pv_rooftop_dev_planes_partition_template()
          thisTemplate['StorageDescriptor']['Location'] = f"{self.pv_rooftops_bucket}/developable_planes/{partition['name']}/"
          thisTemplate['StorageDescriptor']['Parameters']['averageRecordSize'] = partition['averageRecordSize']
          thisTemplate['StorageDescriptor']['Parameters']['recordCount'] = partition['recordCount']
          thisTemplate['StorageDescriptor']['Parameters']['sizeKey'] = partition['sizeKey']
          thisTemplate['Values'][0] = partition['name']
          templateArray.append(thisTemplate)

          #pprint(templateArray)
          #print(count)
          if count%10 == 0:
              #print('submitting')
              logger.info("Submitting pv_rooftop developable_planes partitions batch")
              #pprint(templateArray)
              response2 = self.glue.batch_create_partition(
                  DatabaseName = self.database_name,
                  TableName = self.pv_rooftops_dev_planes_table_name,
                  PartitionInputList = templateArray
              )
              #pprint(response2)
              templateArray = []

      if count%10 != 0:
          logger.info("Submitting pv_rooftop developable_planes partitions batch")
          response2 = self.glue.batch_create_partition(
              DatabaseName=self.database_name,
              TableName=self.pv_rooftops_dev_planes_table_name,
              PartitionInputList=templateArray
          )
          #pprint(response2)


    # This will only work with valid spark partitions
    def create_oedi_table(self, table_input, partitions_array, table_name, partition_template, source_bucket, number_of_partitions):
            try:
                logger.info(f"Recreating table: {table_name}")
                response = self.glue.delete_table(
                    DatabaseName=self.database_name,
                    Name=table_name
                )
            except ClientError as e:
                if e.response['Error']['Code'] == 'EntityNotFoundException':
                    logger.debug(f"Skipping table deletion as it does not exist: {table_name}")

            logger.info("Creating rsf array table")

            response = self.glue.create_table(
                DatabaseName=self.database_name,
                TableInput=table_input
            )

            logger.info(f"Creating {table_name} partitions")

            count = 0
            templateArray = []
            for partition in partitions_array:
                #pprint(partition)
                count = count + 1
                thisTemplate = partition_template
                if number_of_partitions == 2:
                    thisTemplate['StorageDescriptor']['Location'] = f"{source_bucket}/{table_input['PartitionKeys'][0]['Name']}={partition['name'][0]}/{table_input['PartitionKeys'][1]['Name']}={partition['name'][1]}/"
                else:
                    thisTemplate['StorageDescriptor']['Location'] = f"{source_bucket}/{table_input['PartitionKeys'][0]['Name']}={partition['name'][0]}/"

                thisTemplate['StorageDescriptor']['Parameters']['averageRecordSize'] = partition['averageRecordSize']
                thisTemplate['StorageDescriptor']['Parameters']['recordCount'] = partition['recordCount']
                thisTemplate['StorageDescriptor']['Parameters']['sizeKey'] = partition['sizeKey']
                thisTemplate['Values'] = partition['name']
                #print(thisTemplate)

                templateArray.append(thisTemplate.copy())

                # pprint(templateArray)
                # print(count)
                if count % 10 == 0:
                    # print('submitting')
                    logger.info(f"Submitting {table_name} partitions batch")
                    pprint(templateArray)
                    response2 = self.glue.batch_create_partition(
                        DatabaseName=self.database_name,
                        TableName=table_name,
                        PartitionInputList=templateArray
                    )
                    # pprint(response2)
                    templateArray = []

            if count % 10 != 0:
                logger.info(f"Submitting {table_name} partitions batch")
                #pprint(templateArray)
                response2 = self.glue.batch_create_partition(
                    DatabaseName=self.database_name,
                    TableName=table_name,
                    PartitionInputList=templateArray
                )






